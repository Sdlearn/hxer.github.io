<!DOCTYPE HTML>
<html>
    <head>
        <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
        <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
        <title>django 1.8.7 - Wiki | janes</title>
        <meta name="keywords" content=""/>
        <meta name="description" content=""/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="container">
            
<div id="header">
  <div id="post-nav"><a href="/">Home</a>&nbsp;»&nbsp;<a href="/#Python">Python</a>&nbsp;»&nbsp;django 1.8.7</div>
</div>
<div class="clearfix"></div>
<div id="title">django 1.8.7</div>
  <div id="content">
  <h2 id="_1">参考</h2>
<ul>
<li><a href="http://zozoz.github.io/myblog/2015/08/28/django%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%BD%91%E7%AB%99/">Django快速建网站</a></li>
</ul>
<h3 id="_2">基本命令</h3>
<ul>
<li>
<p>django-admin startproject project_name</p>
</li>
<li>
<p>django-admin startapp app_name</p>
</li>
<li>
<p>python manage.py makemigrations</p>
</li>
<li>
<p>python manage.py migrate</p>
</li>
<li>
<p>python manage.py runserver</p>
</li>
<li>
<p>python manage.py collectstatic</p>
</li>
</ul>
<blockquote>
<p>需要先配置 STATIC_ROOT</p>
</blockquote>
<h3 id="_3">国际化和本地化</h3>
<h4 id="_4">本地化配置</h4>
<ul>
<li>根目录下面创建一个locale文件夹，</li>
<li>配置setting.py</li>
</ul>
<div class="hlcode"><pre><span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="n">LANGUAGES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s">&#39;zh-hans&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Simplified Chinese&#39;</span><span class="p">)),</span>  <span class="c"># zh-cn is deprecated</span>
    <span class="p">(</span><span class="s">&#39;en&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;English&#39;</span><span class="p">)),</span>
<span class="p">]</span>

<span class="n">LOCALE_PATHS</span> <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">&#39;locale/&#39;</span><span class="p">),)</span>  <span class="c">#[must be tuple]</span>

<span class="n">MIDDLEWARE_CLASSES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.middleware.locale.LocaleMiddleware&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="o">...</span>
        <span class="s">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;context_processors&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="o">...</span>
                <span class="s">&#39;django.template.context_processors.i18n&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span>
</pre></div>


<blockquote>
<p>if no translation is found. leave the default: LANGUAGE_CODE = 'en-us'</p>
<p>LocaleMiddleware 指定语言偏好。中间件的顺序是有影响的，最好按照依照以下要求：
保证它是第一批安装的中间件类。
因为 LocalMiddleware 要用到session数据，所以需要放在 SessionMiddleware 之后。
如果你使用CacheMiddleware,把LocaleMiddleware放在它后面。</p>
<p>LocaleMiddleware 按照如下算法确定用户的语言:
首先，在当前用户的 session 的中查找django_language键；
如未找到，它会找寻一个cookie
还找不到的话，它会在 HTTP 请求头部里查找Accept‐Language，
该头部是你的浏览器发送的，并且按优先顺序告诉服务器你的语言偏好。
Django会尝试头部中的每一个语种直到它发现一个可用的翻译。
以上都失败了的话, 就使用全局的 LANGUAGE_CODE 设定值。
中文 -&gt; LANGUAGE_CODE = 'zh-hans'</p>
<p>Django寻找项目中的翻译
首先，Django在该视图所在的应用程序文件夹中寻找 locale 目录。
若找到所选语言的翻译，则加载该翻译。
第二步，Django在项目目录中寻找 locale 目录。 若找到翻译，则加载该翻译。
最后，Django使用 django/conf/locale 目录中的基本翻译。</p>
</blockquote>
<h4 id="_5">命令创建文件</h4>
<ul>
<li>然后使用命令创建国际化文件：</li>
</ul>
<div class="hlcode"><pre> <span class="n">django</span><span class="o">-</span><span class="n">admin</span><span class="o">.</span><span class="n">py</span> <span class="n">makemessages</span> <span class="o">-</span><span class="n">l</span> <span class="n">zh_Hans</span>
</pre></div>


<blockquote>
<p>zh_Hans 必须与setting.py 中 LANGUAGES 配置相同, 而且不能是 <strong>zh-hans</strong>, '-' 与'_' 有区别; 必须是 <strong>zh_Hans</strong>, zh_hans都是错的</p>
</blockquote>
<p>执行完后，locale 文件夹下面创建  zh_hans/LC_MESSAGES/django.po 写好了所有的翻译后执行：</p>
<div class="hlcode"><pre> <span class="n">django</span><span class="o">-</span><span class="n">admin</span><span class="o">.</span><span class="n">py</span> <span class="n">compilemessages</span>
</pre></div>


<p>生成文件 zh_hans/LC_MESSAGES/django.mo ，最终的目标文件</p>
<ul>
<li>
<p>如果我们在代码或模板中增加或删除了相关的国际化代码,需要从新运行 <strong>makemessages</strong>  和  <strong>compilemessages</strong></p>
</li>
<li>
<p>如果只是改了django.po中的翻译,只需 <strong>compilemessages</strong> 就行了</p>
</li>
</ul>
<h3 id="_6">模板</h3>
<ul>
<li>1.基本</li>
</ul>
<blockquote>
<p>[S]: {% tag %}</p>
<p>[D]: {% tag %} ... {% endtag %}</p>
</blockquote>
<ul>
<li>entends[S]</li>
</ul>
<blockquote>
<p>告诉模板引擎，这个模板继承了另一个模板, 必须放在子模版的第一行</p>
</blockquote>
<ul>
<li>load[S]</li>
</ul>
<blockquote>
<p>读入一个自定义的模板库</p>
</blockquote>
<ul>
<li>include[S]</li>
</ul>
<blockquote>
<p>允许在模板中包含其它的模板的内容</p>
</blockquote>
<ul>
<li>block[D]</li>
</ul>
<blockquote>
<p>告诉模板引擎，子模板可以重载这些部分</p>
</blockquote>
<ul>
<li>
<ol>
<li>翻译</li>
</ol>
</li>
<li>
<p>trans[S] --To enable it, set USE_I18N to True, then load it with {% load i18n %}</p>
</li>
</ul>
<blockquote>
<p>标记需要翻译的字符串</p>
</blockquote>
<p>不允许使用模板中的变量，只能使用单引号或双引号中的字符串</p>
<ul>
<li>blocktrans[S]</li>
</ul>
<blockquote>
<p>标记需要翻译的字符串</p>
</blockquote>
<p>可以使用模板中的变量</p>
<ul>
<li>
<p>3.安全</p>
</li>
<li>
<p>csrf_token[S]</p>
</li>
</ul>
<blockquote>
<p>跨站请求伪造保护标签，在提交表单中需要添加</p>
</blockquote>
<h3 id="_7">注释</h3>
<blockquote>
<p>{# add some comment #}</p>
</blockquote>
<h3 id="_8">备注</h3>
<p>国际化 -- Internationalization，i 和 n 之间有 18 个字母，简称 I18N,。
本地化 -- localization， l 和 n 之间有 10 个字母，简称 L10N</p>
<h3 id="some-examples">some examples</h3>
<ul>
<li>1.block.supper</li>
</ul>
<div class="hlcode"><pre># Template: A.html

<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        {% block hello %}
            HELLO
        {% endblock %}
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>

# Template B.html
{% extends &quot;A.html&quot; %}
{% block hello %}
World
{% endblock %}

# Rendered Template B
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
World
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>

# Template C
{% extends &quot;A.html&quot; %}
{% block hello %}
{{ block.super }} World
{% endblock %}

# Rendered Template C
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
Hello World
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>


<h3 id="note">note</h3>
<ul>
<li>
<p>login redirect</p>
<p>django登录后默认的跳转页面是 "/account/profile/",可以在 settings.py 文件中设置，改变重定向，如</p>
<blockquote>
<p>LOGIN_REDIRECT_URL = '/'</p>
</blockquote>
</li>
<li>
<p>自定义的 app 名称避免与内建名称相同</p>
</li>
<li>
<p>models field</p>
</li>
<li>
<p>OneToOneField vs ForeignKey</p>
</li>
</ul>
<p>OneToOneField, A one-to-one relationship. Conceptually, this is similar to a ForeignKey with unique=True, but the "reverse" side of the relation will directly return a single object.</p>
<p>In contrast to the OneToOneField "reverse" relation, a ForeignKey "reverse" relation returns a QuerySet</p>
<p>参考: <a href="http://stackoverflow.com/questions/5870537/whats-the-difference-between-django-onetoonefield-and-foreignkey">What's the difference between django OneToOneField and ForeignKey</a></p>
<ul>
<li>
<p>windows 运行 django</p>
</li>
<li>
<p>"python manage.py runserver", cmd 需要管理员权限执行</p>
</li>
<li>
<p>小心端口占用，酷狗音乐使用了 8000 端口</p>
</li>
<li>
<p>settings</p>
</li>
<li>
<p>"from django.conf import settings" is better than "from yourprojectname import settings", for better portability</p>
</li>
<li>
<p>STATIC_ROOT = 'staticfiles'</p>
</li>
</ul>
<blockquote>
<p>relative path, when run "python manage.py collectstatic", collect static files to this directory</p>
</blockquote>
<ul>
<li>
<p>django查找静态文件的范围</p>
<ul>
<li>
<p>yourapp/static/yourapp/staticfiles</p>
</li>
<li>
<p>STATICFILES_DIRS</p>
</li>
<li>
<p>STATIC_ROOT</p>
</li>
</ul>
</li>
<li>
<p>MEDIA_ROOT --must absolute path</p>
</li>
<li>
<p>use "MEDIA_URL" in template
    must add "django.core.context_processors.media" in settings.py-&gt;TEMPLATES-&gt;OPTIONS-&gt;context_processors</p>
</li>
<li>
<p>request</p>
<ul>
<li>request.path    除域名以外的请求路径，以正斜杠开头   "/hello/"</li>
<li>request.get_host()  主机名（比如，通常所说的域名） "127.0.0.1:8000" or "www.example.com"</li>
<li>request.get_full_path() 请求路径，可能包含查询字符串  "/hello/?print=true"</li>
<li>
<p>request.is_secure() HTTPS访问，返回True，否则返回False   True 或者 False</p>
</li>
<li>
<p>request.META 是一个Python字典，包含了所有本次HTTP请求的Header信息</p>
<ul>
<li>HTTP_REFERER，进站前链接网页</li>
<li>HTTP_USER_AGENT，用户浏览器的user-agent字符串</li>
<li>REMOTE_ADDR 客户端IP，(如果申请是经过代理服务器的话，那么它可能是以逗号分割的多个IP地址，如："12.345.67.89,23.456.78.90" 。)</li>
</ul>
</li>
</ul>
<blockquote>
<p>request.META 是一个普通的Python字典，访问一个不存在的键时，会触发一个KeyError异常</p>
</blockquote>
<ul>
<li>request.GET 和 request.POST --类字典对象</li>
</ul>
</li>
<li>
<p>form</p>
</li>
</ul>
<p>is_valid()方法：验证它的数据是否合法。</p>
<p>errors属性：提供了一个字段与错误消息相映射的字典表</p>
<p>cleaned_data属性：在数据合法的情况下，它包含干净的提交数据的字典</p>
<p>Django的form系统自动寻找匹配的函数方法，该方法名称以clean_开头，并以字段名称结束。 如果有这样的方法，它将在校验时被调用;自定义的clean_func()方法将在指定字段的默认校验逻辑执行之后被调用</p>
</div>

        </div>
        <div id="footer">
            <span>
                Copyright © 2012-2016 .
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
            </span>
        </div>
        
    </body>
</html>