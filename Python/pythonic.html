<!DOCTYPE HTML>
<html>
    <head>
        <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
        <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
        <title>Pythonic - Wiki | janes</title>
        <meta name="keywords" content=""/>
        <meta name="description" content=""/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="container">
            
<div id="header">
  <div id="post-nav"><a href="/">Home</a>&nbsp;»&nbsp;<a href="/#Python">Python</a>&nbsp;»&nbsp;Pythonic</div>
</div>
<div class="clearfix"></div>
<div id="title">Pythonic</div>
  <div id="content">
  <p><a href="https://wiki.python.org/moin/PythonSpeed/PerformanceTips">PythonSpeedPerformanceTips</a></p>
<h2 id="0x01">0x01 字符串</h2>
<h3 id="_1">列表转字符串</h3>
<p>避免使用如下方式</p>
<div class="hlcode"><pre><span class="n">s</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
<span class="k">for</span> <span class="n">substring</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="n">substring</span>
</pre></div>


<p>尽量使用 <code>s = "".join(list)</code> 这种方式</p>
<h3 id="_2">格式化字符串</h3>
<p>避免使用 <code>out = "&lt;html&gt;" + head + prologue + query + tail + "&lt;/html&gt;"</code>  <br />
应该使用 <code>out = "&lt;html&gt;%s%s%s%s&lt;/html&gt;" % (head, prologue, query, tail)</code>  <br />
或者可读性更好的方式 <code>out = "&lt;html&gt;%(head)s%(prologue)s%(query)s%(tail)s&lt;/html&gt;" % locals()</code></p>
<h2 id="0x02">0x02 字典</h2>
<h3 id="if">减少循环中 if 判断</h3>
<p>使用字典做词频统计</p>
<div class="hlcode"><pre><span class="n">wdict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">word</span> <span class="n">in</span> <span class="n">words</span><span class="o">:</span>
    <span class="k">if</span> <span class="n">word</span> <span class="n">not</span> <span class="n">in</span> <span class="n">wdict</span><span class="o">:</span>
        <span class="n">wdict</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">wdict</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>


<p>使用 <code>try</code> 替代 <code>if</code> 判断</p>
<div class="hlcode"><pre><span class="n">wdict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">word</span> <span class="n">in</span> <span class="n">words</span><span class="o">:</span>
    <span class="nl">try:</span>
        <span class="n">wdict</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">except</span> <span class="n">KeyError</span><span class="o">:</span>
        <span class="n">wdict</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>


<p>使用 get 方式</p>
<div class="hlcode"><pre><span class="n">wdict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">get</span> <span class="o">=</span> <span class="n">wdict</span><span class="p">.</span><span class="n">get</span>
<span class="k">for</span> <span class="n">word</span> <span class="n">in</span> <span class="n">words</span><span class="o">:</span>
    <span class="n">wdict</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>


<p>使用 defaultdict</p>
<div class="hlcode"><pre><span class="n">from</span> <span class="n">collections</span> <span class="n">import</span> <span class="n">defaultdict</span>

<span class="n">wdict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span>

<span class="k">for</span> <span class="n">word</span> <span class="n">in</span> <span class="n">words</span><span class="o">:</span>
    <span class="n">wdict</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>


<h2 id="0x03">0x03 循环</h2>
<p>避免使用</p>
<div class="hlcode"><pre><span class="n">newlist</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">word</span> <span class="n">in</span> <span class="n">oldlist</span><span class="o">:</span>
    <span class="n">newlist</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">.</span><span class="n">upper</span><span class="p">())</span>
</pre></div>


<p>map 方式：  <code>newlist = map(str.upper, oldlist)</code>  <br />
列表生成器： <code>newlist = [s.upper() for s in oldlist]</code>  <br />
迭代器：    <code>iterator = (s.upper() for s in oldlist)</code></p>
<p>不能使用以上方式的情况下，避免<code>点号</code>， 减少循环中函数引用带来的开销，但这也会降低程序的可读性</p>
<div class="hlcode"><pre><span class="n">upper</span> <span class="o">=</span> <span class="n">str</span><span class="p">.</span><span class="n">upper</span>
<span class="n">newlist</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">append</span> <span class="o">=</span> <span class="n">newlist</span><span class="p">.</span><span class="n">append</span>
<span class="k">for</span> <span class="n">word</span> <span class="n">in</span> <span class="n">oldlist</span><span class="o">:</span>
    <span class="n">append</span><span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
</pre></div>


<p>尽可能使用 <code>local variable</code>, 而不是 <code>global variable</code></p>
<div class="hlcode"><pre><span class="n">def</span> <span class="n">func</span><span class="p">()</span><span class="o">:</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">str</span><span class="p">.</span><span class="n">upper</span>
    <span class="n">newlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">append</span> <span class="o">=</span> <span class="n">newlist</span><span class="p">.</span><span class="n">append</span>
    <span class="k">for</span> <span class="n">word</span> <span class="n">in</span> <span class="n">oldlist</span><span class="o">:</span>
        <span class="n">append</span><span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">newlist</span>
</pre></div>


<h3 id="ab">集合 A，B 交集判断</h3>
<div class="hlcode"><pre><span class="n">any</span><span class="p">(</span><span class="n">_</span> <span class="n">in</span> <span class="n">A</span> <span class="k">for</span> <span class="n">_</span> <span class="n">in</span> <span class="n">B</span><span class="p">)</span>  <span class="o">=&gt;</span> <span class="n">True</span><span class="p">(</span><span class="n">have</span><span class="p">)</span> <span class="n">or</span> <span class="n">False</span><span class="p">(</span><span class="n">no</span><span class="p">)</span>
</pre></div>


<h3 id="hashlib">hashlib</h3>
<div class="hlcode"><pre><span class="n">import</span> <span class="n">hashlib</span>

<span class="n">clipher</span> <span class="o">=</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;md5&quot;</span><span class="p">,</span> <span class="s">&quot;plain&quot;</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>
</pre></div>
</div>

        </div>
        <div id="footer">
            <span>
                Copyright © 2012-2016 .
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
            </span>
        </div>
        
    </body>
</html>