<!DOCTYPE HTML>
<html>
    <head>
        <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
        <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
        <title>scapy - Wiki | janes</title>
        <meta name="keywords" content=""/>
        <meta name="description" content=""/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="container">
            
<div id="header">
  <div id="post-nav"><a href="/">Home</a>&nbsp;»&nbsp;<a href="/#Python">Python</a>&nbsp;»&nbsp;scapy</div>
</div>
<div class="clearfix"></div>
<div id="title">scapy</div>
  <div id="content">
  <h1 id="dns">DNS</h1>
<h2 id="ip-reverse-ip-domain-check">IP反向查询域名 Reverse IP Domain Check</h2>
<h1 id="arp">ARP</h1>
<h2 id="arp-scan">ARP scan</h2>
<p>局域网主机探测扫描，含有线或无线局域网</p>
<p>方式1 ARP请求</p>
<div class="hlcode"><pre><span class="err">$</span><span class="n">sudo</span> <span class="n">scapy</span>

<span class="o">&gt;</span><span class="n">pkt</span><span class="o">=</span><span class="n">Ether</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="s">&quot;ff:ff:ff:ff:ff:ff&quot;</span><span class="p">)</span><span class="o">/</span><span class="n">ARP</span><span class="p">(</span><span class="n">hwtype</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ptype</span><span class="o">=</span><span class="mh">0x0800</span><span class="p">,</span><span class="n">op</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">pdst</span><span class="o">=</span><span class="s">&quot;192.168.199.0/24&quot;</span><span class="p">)</span>

<span class="o">&gt;</span><span class="n">srp</span><span class="p">(</span><span class="n">pkt</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">Begin</span> <span class="n">emission</span><span class="o">:</span>
<span class="n">Finished</span> <span class="n">to</span> <span class="n">send</span> <span class="mi">256</span> <span class="n">packets</span><span class="p">.</span>
<span class="p">.......</span>
<span class="n">Received</span> <span class="mi">7</span> <span class="n">packets</span><span class="p">,</span> <span class="n">got</span> <span class="mi">0</span> <span class="n">answers</span><span class="p">,</span> <span class="n">remaining</span> <span class="mi">256</span> <span class="n">packets</span>
<span class="p">(</span><span class="o">&lt;</span><span class="n">Results</span><span class="o">:</span> <span class="n">TCP</span><span class="o">:</span><span class="mi">0</span> <span class="n">UDP</span><span class="o">:</span><span class="mi">0</span> <span class="n">ICMP</span><span class="o">:</span><span class="mi">0</span> <span class="n">Other</span><span class="o">:</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Unanswered</span><span class="o">:</span> <span class="n">TCP</span><span class="o">:</span><span class="mi">0</span> <span class="n">UDP</span><span class="o">:</span><span class="mi">0</span> <span class="n">ICMP</span><span class="o">:</span><span class="mi">0</span> <span class="n">Other</span><span class="o">:</span><span class="mi">256</span><span class="o">&gt;</span><span class="p">)</span>

<span class="o">&gt;</span><span class="n">ans</span><span class="p">,</span><span class="n">unans</span><span class="o">=</span><span class="n">_</span>

<span class="o">&gt;</span><span class="n">ans</span><span class="p">.</span><span class="n">summary</span><span class="p">(</span><span class="n">lambda</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">r</span><span class="p">)</span><span class="o">:</span><span class="n">r</span><span class="p">.</span><span class="n">sprintf</span><span class="p">(</span><span class="s">&quot;%Ehter.src%:%ARP.psrc%&quot;</span><span class="p">))</span>

<span class="o">??:</span><span class="mf">192.168.199.1</span>
</pre></div>


<p>opcode:1(请求包)
hardware type:1(以太网)
protocol type:0x0800(IP)</p>
<h2 id="send-receive">send &amp; receive</h2>
<div class="hlcode"><pre><span class="nx">sr</span><span class="p">()</span>
<span class="o">--</span> <span class="nx">The</span> <span class="nx">sr</span><span class="p">()</span> <span class="kd">function</span> <span class="nx">is</span> <span class="k">for</span> <span class="nx">sending</span> <span class="nx">packets</span> <span class="nx">and</span> <span class="nx">receiving</span> <span class="nx">answers</span><span class="p">.</span> <span class="nx">The</span> <span class="kd">function</span> <span class="nx">returns</span>
<span class="nx">a</span> <span class="nx">couple</span> <span class="nx">of</span> <span class="nx">packet</span> <span class="nx">and</span> <span class="nx">answers</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">unanswered</span> <span class="nx">packets</span><span class="p">.</span>

<span class="nx">sr1</span><span class="p">()</span> 
<span class="o">--</span> <span class="nx">This</span> <span class="kd">function</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">variant</span> <span class="nx">that</span> <span class="nx">only</span> <span class="nx">returns</span> <span class="nx">one</span> <span class="nx">packet</span> <span class="nx">that</span> <span class="nx">answered</span> <span class="nx">the</span> <span class="nx">sent</span>
<span class="nx">packet</span> <span class="p">(</span><span class="nx">or</span> <span class="nx">the</span> <span class="nx">packet</span> <span class="nx">set</span><span class="p">)</span> <span class="nx">sent</span><span class="p">.</span>

<span class="nx">srp</span><span class="p">()</span>
<span class="o">--</span> <span class="nx">The</span> <span class="kd">function</span> <span class="nx">srp</span><span class="p">()</span> <span class="nx">does</span> <span class="nx">the</span> <span class="nx">same</span> <span class="k">for</span> <span class="nx">layer</span> <span class="mi">2</span> <span class="nx">packets</span> <span class="p">(</span><span class="nx">Ethernet</span><span class="p">,</span> <span class="mf">802.3</span><span class="p">,</span> <span class="nx">etc</span><span class="p">).</span>
</pre></div>


<h2 id="_1">构造数据包常用参数</h2>
<ul>
<li>IP()</li>
</ul>
<div class="hlcode"><pre><span class="n">src</span>   <span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span> <span class="n">src</span><span class="o">=</span><span class="s">&quot;192.168.222.222&quot;</span>
<span class="n">dst</span>   <span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span> <span class="n">dst</span><span class="o">=</span><span class="s">&quot;192.168.0.1&quot;</span>
<span class="n">ttl</span>   <span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> 
</pre></div>


<ul>
<li>ICMP()</li>
</ul>
<div class="hlcode"><pre><span class="n">type</span>   <span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span> <span class="n">type</span><span class="o">=</span><span class="mi">8</span><span class="p">(</span><span class="n">Echo</span> <span class="p">(</span><span class="n">ping</span><span class="p">)</span> <span class="n">request</span><span class="p">)</span>
                 <span class="mi">0</span><span class="p">(</span><span class="n">Echo</span> <span class="p">(</span><span class="n">ping</span><span class="p">)</span> <span class="n">reply</span><span class="p">)</span>
</pre></div>


<ul>
<li>TCP()</li>
</ul>
<div class="hlcode"><pre><span class="n">sport</span>
<span class="n">dport</span>   <span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span> <span class="n">dport</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">80</span><span class="p">]</span>
<span class="n">flags</span>   <span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span> <span class="n">flags</span><span class="o">=</span><span class="s">&quot;S&quot;</span><span class="o">--</span><span class="n">SYN</span>
<span class="n">inter</span>
<span class="n">retry</span>
<span class="n">timeout</span>
</pre></div>
</div>

        </div>
        <div id="footer">
            <span>
                Copyright © 2012-2016 .
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
            </span>
        </div>
        
    </body>
</html>