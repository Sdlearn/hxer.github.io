<!DOCTYPE HTML>
<html>
    <head>
        <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
        <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
        <title>迭代器和生成器 - Wiki | janes</title>
        <meta name="keywords" content=""/>
        <meta name="description" content=""/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="container">
            
<div id="header">
  <div id="post-nav"><a href="/">Home</a>&nbsp;»&nbsp;<a href="/#Python">Python</a>&nbsp;»&nbsp;迭代器和生成器</div>
</div>
<div class="clearfix"></div>
<div id="title">迭代器和生成器</div>
  <div id="content">
  <h2 id="_1">迭代器</h2>
<p>__iter__ 是迭代规则(iterator potocol)的基础，对象如果没有它，就不能返回迭代器，就没有next()方法，就不能迭代。</p>
<p>__iter__()是类中的核心，它返回迭代器本身，一个实现了__iter__()方法的对象，即意味着是可迭代的。含有next()的对象，就是迭代器，并且在这个方法中，在没有元素的时候要发起 StopIteration()异常</p>
<div class="hlcode"><pre><span class="n">Class</span> <span class="n">Fibs</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">max</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="nb">max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">flib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="k">if</span> <span class="n">fib</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
        <span class="k">return</span> <span class="n">flib</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">flibs</span> <span class="o">=</span> <span class="n">Flibs</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">print</span> <span class="nb">list</span><span class="p">(</span><span class="n">fibs</span><span class="p">)</span> 


<span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</pre></div>


<h2 id="_2">生成器</h2>
<ul>
<li>简单的生成器</li>
</ul>
<div class="hlcode"><pre><span class="n">gen</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">gen</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">generator</span> <span class="nb">object</span> <span class="o">&lt;</span><span class="n">genexpr</span><span class="o">&gt;</span> <span class="n">at</span> <span class="mh">0x7f18a06dac80</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gen</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>     <span class="k">print</span> <span class="n">i</span>
   <span class="o">....</span><span class="p">:</span>     
<span class="mi">0</span>
<span class="mi">1</span>
<span class="mi">4</span>
<span class="mi">9</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gen</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">i</span>
   <span class="o">....</span><span class="p">:</span>     
</pre></div>


<p>这和列表推导 [x*x for x in range(4)] 是不一样的，列表推导返回的是一个列表对象。可以多次打印，看上面的例子可以发现，第二次打印没有结果。这是迭代器所具有的，迭代器（生成器是迭代器）的优势在于少占内存</p>
<div class="hlcode"><pre># sum里面不需要再加一层括号
sum(i*i for i in range(10))

not 

sum([i*i for i in range(10)])
</pre></div>


<ul>
<li>yield</li>
</ul>
<p>yield是生成器的标志， 含有yield语句的函数称为生成器。生成器是一种用普通函数语法定义的迭代器，在定义过程中并没有像迭代器那样写 <strong>iter</strong>() 和 next(), 只是用了yiel语句，函数就成了生成器，具备迭代器的功能特性。</p>
<div class="hlcode"><pre>def g():
    yield 0
    yield 1
    yield 2

for i in g():
    print i

0
1
2
</pre></div>
</div>

        </div>
        <div id="footer">
            <span>
                Copyright © 2012-2016 .
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
            </span>
        </div>
        
    </body>
</html>