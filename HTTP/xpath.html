<!DOCTYPE HTML>
<html>
    <head>
        <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
        <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
        <title>XPATH - Wiki | janes</title>
        <meta name="keywords" content=""/>
        <meta name="description" content=""/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="container">
            
<div id="header">
  <div id="post-nav"><a href="/">Home</a>&nbsp;»&nbsp;<a href="/#HTTP">HTTP</a>&nbsp;»&nbsp;XPATH</div>
</div>
<div class="clearfix"></div>
<div id="title">XPATH</div>
  <div id="content">
  <h2 id="_1">简介</h2>
<p>xpath, 选择XML文件中节点的方法， 节点是XML文件最小构成单位，分为7种</p>
<div class="hlcode"><pre><span class="n">element</span>   <span class="err">（元素节点）</span>
<span class="n">attribute</span> <span class="err">（属性节点）</span>
<span class="n">text</span>      <span class="err">（文本节点）</span>
<span class="n">namespace</span> <span class="err">（名称空间节点）</span>
<span class="n">processing</span><span class="o">-</span><span class="n">instruction</span> <span class="err">（处理命令节点）</span>
<span class="n">comment</span>   <span class="err">（注释节点）</span>
<span class="n">root</span>      <span class="err">（根节点）</span>
</pre></div>


<p><a href="https://addons.mozilla.org/en-US/firefox/addon/xpath-checker/">firefox 插件, 在线编辑展示xpath</a></p>
<h2 id="path-expression">路径表达式 path expression</h2>
<p>xpath通过"路径表达式"（Path Expression）来选择节点</p>
<div class="hlcode"><pre><span class="err">斜杠（</span><span class="o">/</span><span class="err">）作为路径内部的分割符。</span>

<span class="err">绝对路径（</span><span class="n">absolute</span> <span class="n">path</span><span class="err">）</span> <span class="err">必须用</span><span class="s">&quot;/&quot;</span><span class="err">起首，后面紧跟根节点，比如</span><span class="o">/</span><span class="n">step</span><span class="o">/</span><span class="n">step</span><span class="o">/</span><span class="p">...</span>

<span class="err">相对路径（</span><span class="n">relative</span> <span class="n">path</span><span class="err">）则是除了绝对路径以外的其他写法，比如</span> <span class="n">step</span><span class="o">/</span><span class="n">step</span><span class="err">，也就是不使用</span><span class="s">&quot;/&quot;</span><span class="err">起首。</span>

<span class="s">&quot;.&quot;</span><span class="err">表示当前节点。</span>

<span class="s">&quot;..&quot;</span><span class="err">表示当前节点的父节点</span>
</pre></div>


<h2 id="_2">选择节点的基本规则</h2>
<div class="hlcode"><pre><span class="k">-</span> <span class="nf">nodename</span><span class="err">（节点名称）：表示选择该节点的所有子节点</span>

<span class="o">-</span> <span class="s">&quot;/&quot;</span><span class="err">：表示选择根节点</span>

<span class="o">-</span> <span class="s">&quot;//&quot;</span><span class="err">：表示选择任意位置的某个节点</span>

<span class="o">-</span> <span class="s">&quot;@&quot;</span><span class="err">：</span> <span class="err">表示选择某个属性</span>
</pre></div>


<ul>
<li>XML实例</li>
</ul>
<div class="hlcode"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span>
<span class="nt">&lt;bookstore&gt;</span>
  <span class="nt">&lt;book&gt;</span>
    <span class="nt">&lt;title</span> <span class="na">lang=</span><span class="s">&quot;eng&quot;</span><span class="nt">&gt;</span>Harry Potter<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;price&gt;</span>29.99<span class="nt">&lt;/price&gt;</span>
  <span class="nt">&lt;/book&gt;</span>
  <span class="nt">&lt;book&gt;</span>
    <span class="nt">&lt;title</span> <span class="na">lang=</span><span class="s">&quot;eng&quot;</span><span class="nt">&gt;</span>Learning XML<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;price&gt;</span>39.95<span class="nt">&lt;/price&gt;</span>
  <span class="nt">&lt;/book&gt;</span>
<span class="nt">&lt;/bookstore&gt;</span>
</pre></div>


<ul>
<li>e.g.</li>
</ul>
<div class="hlcode"><pre><span class="n">bookstore</span> <span class="err">：选取</span> <span class="n">bookstore</span> <span class="err">元素的所有子节点。</span>

<span class="o">/</span><span class="n">bookstore</span> <span class="err">：选取根节点</span><span class="n">bookstore</span><span class="err">，这是绝对路径写法。</span>

<span class="n">bookstore</span><span class="o">/</span><span class="n">book</span> <span class="err">：选取所有属于</span> <span class="n">bookstore</span> <span class="err">的子元素的</span> <span class="n">book</span><span class="err">元素，这是相对路径写法。</span>

<span class="c1">//book ：选择所有 book 子元素，而不管它们在文档中的位置。</span>

<span class="n">bookstore</span><span class="c1">//book ：选择所有属于 bookstore 元素的后代的 book 元素，而不管它们位于 bookstore 之下的什么位置。</span>

<span class="c1">//@lang ：选取所有名为 lang 的属性</span>
</pre></div>


<h2 id="_3">通配符</h2>
<div class="hlcode"><pre><span class="c"># &quot;*&quot; 表示匹配任何元素节点。</span>
<span class="c"># &quot;@*&quot; 表示匹配任何属性值。</span>
<span class="c"># node() 表示匹配任何类型的节点</span>
</pre></div>


<ul>
<li>e.g.</li>
</ul>
<div class="hlcode"><pre><span class="c1">//* ：选择文档中的所有元素节点。</span>

<span class="o">/</span><span class="err">*/</span><span class="o">*</span> <span class="err">：表示选择所有第二层的元素节点</span>

<span class="c1">//title[@*] ：表示选择所有带有属性的title元素</span>
</pre></div>


<h2 id="xpathpredicate">xpath的谓语条件（Predicate）</h2>
<p>所谓"谓语条件"，就是对路径表达式的附加条件</p>
<p>所有的条件，都写在方括号"[]"中，表示对节点进行进一步的筛选。</p>
<div class="hlcode"><pre><span class="o">/</span><span class="n">bookstore</span><span class="o">/</span><span class="n">book</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="err">：表示选择</span><span class="n">bookstore</span><span class="err">的第一个</span><span class="n">book</span><span class="err">子元素。</span>

<span class="o">/</span><span class="n">bookstore</span><span class="o">/</span><span class="n">book</span><span class="p">[</span><span class="n">last</span><span class="p">()]</span> <span class="err">：表示选择</span><span class="n">bookstore</span><span class="err">的最后一个</span><span class="n">book</span><span class="err">子元素。</span>

<span class="o">/</span><span class="n">bookstore</span><span class="o">/</span><span class="n">book</span><span class="p">[</span><span class="n">last</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="err">：表示选择</span><span class="n">bookstore</span><span class="err">的倒数第二个</span><span class="n">book</span><span class="err">子元素。</span>

<span class="o">/</span><span class="n">bookstore</span><span class="o">/</span><span class="n">book</span><span class="p">[</span><span class="n">position</span><span class="p">()</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">]</span> <span class="err">：表示选择</span><span class="n">bookstore</span><span class="err">的前两个</span><span class="n">book</span><span class="err">子元素。</span>

<span class="c1">//title[@lang] ：表示选择所有具有lang属性的title节点。</span>

<span class="c1">//title[@lang=&#39;eng&#39;] ：表示选择所有lang属性的值等于&quot;eng&quot;的title节点。</span>

<span class="o">/</span><span class="n">bookstore</span><span class="o">/</span><span class="n">book</span><span class="p">[</span><span class="n">price</span><span class="p">]</span> <span class="err">：表示选择</span><span class="n">bookstore</span><span class="err">的</span><span class="n">book</span><span class="err">子元素，且被选中的</span><span class="n">book</span><span class="err">元素必须带有</span><span class="n">price</span><span class="err">子元素。</span>

<span class="o">/</span><span class="n">bookstore</span><span class="o">/</span><span class="n">book</span><span class="p">[</span><span class="n">price</span><span class="o">&gt;</span><span class="mf">35.00</span><span class="p">]</span> <span class="err">：表示选择</span><span class="n">bookstore</span><span class="err">的</span><span class="n">book</span><span class="err">子元素，且被选中的</span><span class="n">book</span><span class="err">元素的</span><span class="n">price</span><span class="err">子元素值必须大于</span><span class="mi">35</span><span class="err">。</span>

<span class="o">/</span><span class="n">bookstore</span><span class="o">/</span><span class="n">book</span><span class="p">[</span><span class="n">price</span><span class="o">&gt;</span><span class="mf">35.00</span><span class="p">]</span><span class="o">/</span><span class="n">title</span> <span class="err">：表示在例</span><span class="mi">14</span><span class="err">结果集中，选择</span><span class="n">title</span><span class="err">子元素。</span>

<span class="o">/</span><span class="n">bookstore</span><span class="o">/</span><span class="n">book</span><span class="o">/</span><span class="n">price</span><span class="p">[.</span><span class="o">&gt;</span><span class="mf">35.00</span><span class="p">]</span> <span class="err">：表示选择值大于</span><span class="mi">35</span><span class="err">的</span><span class="s">&quot;/bookstore/book&quot;</span><span class="err">的</span><span class="n">price</span><span class="err">子元素</span>
</pre></div>


<h2 id="_4">选择多个路径</h2>
<p>用"|"选择多个并列的路径。</p>
<div class="hlcode"><pre><span class="c1">//book/title | //book/price ：表示同时选择book元素的title子元素和price子元素</span>
</pre></div>


<h2 id="xpath-axes">XPath 轴（Axes）</h2>
<p>轴可定义相对于当前节点的节点集。</p>
<div class="hlcode"><pre><span class="n">ancestor</span>    <span class="err">选取当前节点的所有先辈（父、祖父等）。</span>
<span class="n">ancestor</span><span class="o">-</span><span class="n">or</span><span class="o">-</span><span class="n">self</span>    <span class="err">选取当前节点的所有先辈（父、祖父等）以及当前节点本身。</span>
<span class="n">attribute</span>   <span class="err">选取当前节点的所有属性。</span>
<span class="n">child</span>       <span class="err">选取当前节点的所有子元素。</span>
<span class="n">descendant</span>  <span class="err">选取当前节点的所有后代元素（子、孙等）。</span>
<span class="n">descendant</span><span class="o">-</span><span class="n">or</span><span class="o">-</span><span class="n">self</span>  <span class="err">选取当前节点的所有后代元素（子、孙等）以及当前节点本身。</span>
<span class="n">following</span>   <span class="err">选取文档中当前节点的结束标签之后的所有节点。</span>
<span class="n">namespace</span>   <span class="err">选取当前节点的所有命名空间节点。</span>
<span class="n">parent</span>      <span class="err">选取当前节点的父节点。</span>
<span class="n">preceding</span>   <span class="err">选取文档中当前节点的开始标签之前的所有节点。</span>
<span class="n">preceding</span><span class="o">-</span><span class="n">sibling</span>   <span class="err">选取当前节点之前的所有同级节点。</span>
<span class="n">self</span>        <span class="err">选取当前节点。</span>
</pre></div>


<ul>
<li>e.g.</li>
</ul>
<div class="hlcode"><pre><span class="n">child</span><span class="o">::*</span>  <span class="err">选取当前节点的所有子元素。</span>
<span class="n">attribute</span><span class="o">::*</span>  <span class="err">选取当前节点的所有属性。</span>
<span class="n">child</span><span class="o">::</span><span class="n">text</span><span class="p">()</span>  <span class="err">选取当前节点的所有文本子节点。</span>
<span class="n">child</span><span class="o">::</span><span class="n">node</span><span class="p">()</span>  <span class="err">选取当前节点的所有子节点。</span>
</pre></div>


<h2 id="_5">运算符</h2>
<div class="hlcode"><pre><span class="o">|</span>   <span class="err">计算两个节点集</span>    <span class="c1">//book | //cd --&gt; 返回所有拥有 book 和 cd 元素的节点集</span>
<span class="o">+</span>   <span class="err">加法</span>  <span class="mi">6</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">--&gt;</span> <span class="mi">10</span>
<span class="o">-</span>   <span class="err">减法</span>  <span class="mi">6</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">--&gt;</span> <span class="mi">2</span>
<span class="o">*</span>   <span class="err">乘法</span>  <span class="mi">6</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">--&gt;</span> <span class="mi">24</span>
<span class="n">div</span> <span class="err">除法</span>  <span class="mi">8</span> <span class="n">div</span> <span class="mi">4</span> <span class="o">--&gt;</span> <span class="mi">2</span>
<span class="n">mod</span> <span class="err">计算除法的余数</span> <span class="mi">5</span> <span class="n">mod</span> <span class="mi">2</span> <span class="o">--&gt;</span> <span class="mi">1</span>

<span class="o">=</span>   <span class="err">等于</span>  <span class="n">price</span><span class="o">=</span><span class="mf">9.80</span> <span class="o">--&gt;</span> <span class="err">如果</span> <span class="n">price</span> <span class="err">是</span> <span class="mf">9.80</span><span class="err">，则返回</span> <span class="nb">true</span><span class="p">,</span> <span class="err">否则</span><span class="nb">false</span>
<span class="o">!=</span>  <span class="err">不等于</span> 
<span class="o">&lt;</span>   <span class="err">小于</span>   
<span class="o">&lt;=</span>  <span class="err">小于或等于</span>       
<span class="o">&gt;</span>   <span class="err">大于</span>      
<span class="o">&gt;=</span>  <span class="err">大于或等于</span>       

<span class="n">or</span>  <span class="err">或</span>       
<span class="n">and</span> <span class="err">与</span>   
<span class="n">not</span><span class="p">()</span> <span class="err">逻辑非</span>

<span class="o">:</span>   <span class="err">命名空间分隔符，将命名空间前缀与元素名或属性名分隔</span> 
</pre></div>


<blockquote>
<p>= 比较是弱类型比较， 1 = ”1“ --&gt; true</p>
</blockquote>
<h2 id="function">function</h2>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/XPath/Functions">XPATH function document</a></p>
<p>常用函数：</p>
<div class="hlcode"><pre><span class="nt">&lt;bookstore&gt;</span>
    <span class="nt">&lt;book&gt;</span>
        <span class="nt">&lt;title</span> <span class="na">lang=</span><span class="s">&quot;eng&quot;</span><span class="nt">&gt;</span>Harry Potter<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;price&gt;</span>29.99<span class="nt">&lt;/price&gt;</span>
    <span class="nt">&lt;/book&gt;</span>

    <span class="nt">&lt;book&gt;</span>
        <span class="nt">&lt;title</span> <span class="na">lang=</span><span class="s">&quot;eng&quot;</span><span class="nt">&gt;</span>Learn XML<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;price&gt;</span>39.95<span class="nt">&lt;/price&gt;</span>
    <span class="nt">&lt;/book&gt;</span>

    <span class="nt">&lt;test&gt;</span>
      <span class="nt">&lt;item&gt;</span>Apple<span class="nt">&lt;/item&gt;</span>
      <span class="nt">&lt;item&gt;</span>Banana<span class="nt">&lt;/item&gt;</span>
      <span class="nt">&lt;item&gt;</span>Orange<span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;/test&gt;</span>
<span class="nt">&lt;/bookstore&gt;</span>

name(<span class="cp">[</span><span class="nx">node</span><span class="na">-set</span><span class="cp">]</span>)  返回节点的名字(string)

count(node-set)  返回参数node-set中的节点个数
    count(//test/child::node())，将会返回和test处于兄弟节点的全部子节点的总数 --&gt; 7

string(<span class="cp">[</span><span class="nx">onject</span><span class="cp">]</span>)  返回对象转换的字符串
    string(1) --&gt; &quot;1&quot;
    string(//test/item) --&gt; &quot;Apple&quot;
    string(//test) --&gt; 43字符的字符串 ...

string-length(string)  取字符串的长度，如果参数被省略则计算上下文节点的string-value值的长度
    stringlength(//user<span class="cp">[</span><span class="nb">position</span><span class="p">()</span><span class="o">=</span><span class="mi">1</span><span class="cp">]</span>/child::node()<span class="cp">[</span><span class="nb">position</span><span class="p">()</span><span class="o">=</span><span class="mi">1</span><span class="cp">]</span>)，将会返回user的第一个节点包含的一个字符串的长度

substring(string, start <span class="cp">[</span><span class="p">,</span><span class="nb">length</span><span class="cp">]</span>)  取子字符串，注意字符串的位置从1开始
    substring((//user<span class="cp">[</span><span class="nb">position</span><span class="p">()</span><span class="o">=</span><span class="mi">1</span><span class="cp">]</span>/child::node()<span class="cp">[</span><span class="nb">position</span><span class="p">()</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="err">，将会返回</span><span class="nb">user</span><span class="err">的第一个节点（</span><span class="nb">name</span><span class="err">）的第二个字母</span>

<span class="nx">translate</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">)</span> <span class="err">返回第一个字符串，</span> <span class="err">第一个字符串中出现第二个参数字符串中的字符的位置，替换为第三个参数字符串中对应位置的字符</span>
    <span class="nx">translate</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;abc&quot;</span><span class="p">,</span> <span class="s2">&quot;ABC&quot;</span><span class="p">)</span> <span class="o">--&gt;</span> <span class="nx">BAr</span>

<span class="nx">concat</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span> <span class="err">[</span><span class="p">,</span> <span class="kt">string</span><span class="cp">]</span>*)  返回参数的串联， 如果参数不是字符串类型，将先使用string()函数转换为字符串，然后计算转换的结果
    concat(&quot;ab&quot;, 3, &quot;ef&quot;, &quot;g&quot;) --&gt; &quot;ab3efg&quot;

contains(string1, string2)  返回 true, 当第一个参数字符串包含第二个参数字符串， 否则返回 false
    contains(//test, &quot;Banana&quot;) --&gt; true
</pre></div>
</div>

        </div>
        <div id="footer">
            <span>
                Copyright © 2012-2016 .
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
            </span>
        </div>
        
    </body>
</html>