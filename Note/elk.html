<!DOCTYPE HTML>
<html>
    <head>
        <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
        <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
        <title>ELK - Wiki | janes</title>
        <meta name="keywords" content=""/>
        <meta name="description" content=""/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="container">
            
<div id="header">
  <div id="post-nav"><a href="/">Home</a>&nbsp;»&nbsp;<a href="/#Note">Note</a>&nbsp;»&nbsp;ELK</div>
</div>
<div class="clearfix"></div>
<div id="title">ELK</div>
  <div id="content">
  <h2 id="_1">简介</h2>
<p><a href="http://kibana.logstash.es/content/">ELK 中文指南</a></p>
<p>ELK 是 Elasticsearch、Logstash、Kibana 三个开源软件的组合</p>
<h3 id="elasticsearch">ElasticSearch</h3>
<p>Elasticsearch是一个基于Apache Lucene(TM)的开源的实时分布式搜索和分析引擎,可以快速处理大数据，用于全文搜索、结构化搜索、分析以及将这三者混合使用。</p>
<p><a href="https://www.elastic.co/downloads/elasticsearch">Elasticsearch download</a></p>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/_installation.html">Elasticsearch install and running</a></p>
<div class="hlcode"><pre>$ <span class="nb">cd</span> elasticsearch-2.3.1
$ bin/elasticsearch

<span class="c1"># browser http://locaolhost:9200</span>

<span class="c1"># get the following output</span>
<span class="o">{</span>
  <span class="s2">&quot;name&quot;</span> : <span class="s2">&quot;X-23&quot;</span>,
  <span class="s2">&quot;cluster_name&quot;</span> : <span class="s2">&quot;elasticsearch&quot;</span>,
  <span class="s2">&quot;version&quot;</span> : <span class="o">{</span>
    <span class="s2">&quot;number&quot;</span> : <span class="s2">&quot;2.3.1&quot;</span>,
    <span class="s2">&quot;build_hash&quot;</span> : <span class="s2">&quot;bd980929010aef404e7cb0843e61d0665269fc39&quot;</span>,
    <span class="s2">&quot;build_timestamp&quot;</span> : <span class="s2">&quot;2016-04-04T12:25:05Z&quot;</span>,
    <span class="s2">&quot;build_snapshot&quot;</span> : false,
    <span class="s2">&quot;lucene_version&quot;</span> : <span class="s2">&quot;5.5.0&quot;</span>
  <span class="o">}</span>,
  <span class="s2">&quot;tagline&quot;</span> : <span class="s2">&quot;You Know, for Search&quot;</span>
<span class="o">}</span>
</pre></div>


<h3 id="logstash">Logstash</h3>
<p><a href="https://www.elastic.co/downloads/logstash">logstash download</a></p>
<p><a href="https://www.elastic.co/guide/en/logstash/current/index.html">logstash document</a></p>
<p>run:</p>
<div class="hlcode"><pre><span class="cp">../logstash-2.3.1$ bin/logstash -e &#39;input{stdin{}}output{stdout{codec=&gt;rubydebug}}&#39;</span>
Settings: Default pipeline workers: 4
Pipeline main started
hello world
{
       &quot;message&quot; =&gt; &quot;hello world&quot;,
      &quot;@version&quot; =&gt; &quot;1&quot;,
    &quot;@timestamp&quot; =&gt; &quot;2016-04-13T03:37:00.404Z&quot;,
          &quot;host&quot; =&gt; &quot;kali&quot;
}
</pre></div>


<p>终端输入 Hello World，回车，然后看看会返回结果, 如上所示</p>
<h3 id="kibana">Kibana</h3>
<p><a href="https://www.elastic.co/downloads/kibana">kibana download</a></p>
<p><a href="https://www.elastic.co/guide/en/kibana/current/setup.html">kibana install and running</a></p>
<p>download tar.gz and extract</p>
<div class="hlcode"><pre>cd kibana-4.5.0-linux-x64/bin
./kibana 

# browser
http://localhost:5601
</pre></div>


<p>install and run app sense</p>
<div class="hlcode"><pre>cd kibana-4.5.0-linux-x64/bin
./kibana plugin --install elastic/sense
./bin/kibana
</pre></div>


<p>Open Sense your web browser by going to http://localhost:5601/app/sense</p>
<h3 id="elk">ELK</h3>
<div class="hlcode"><pre>### Elasticsearch ###
cd elasticsearch-2.3.1
bin/elasticsearch


### logstash ###
cd logstash-2.3.1
mkdir conf 
mkdir /var/opt/logs
echo &quot;hello&quot; &gt; /var/opt/logs/test.log
vim conf/logstash-indexer.conf

input{                                                                          
    file {
        path =&gt; [&quot;/var/opt/logs/test.log&quot;]
    }                                                                    
}                                                                               

output {                                                                        
    elasticsearch {                                                             
        hosts =&gt; [&quot;localhost:9200&quot;]                                             
    }                                                                           

    stdout {                                                                    
        codec =&gt; rubydebug                                                      
    }                                                                           
} 

bin/logstash -f conf/logstash-indexer.conf


### Kibana ###
cd kibana-4.5.0-linux-x64/
vim config/kibana.yml

## 更改如下 ##
# The Elasticsearch instance to use for all your queries.                  
  15 elasticsearch.url: &quot;http://localhost:9200&quot;

bin/kibana


### browser ### 
http://localhost:5601  
</pre></div>


<div class="hlcode"><pre># Elasticseatch 后台进程运行
nohup ./elasticsearch &amp; 
</pre></div>


<p>新建索引配置文件logstash-indexer.conf，input{file{...}}部分指定的是日志文件的位置（可以多个文件）。output部分则是表示将日志文件的内容保存到elasticsearch，这里hosts对应的是一个数组，可以设置多个elasticsearch主机，相当于一份日志文件的内容，可以保存到多个elasticsearch中。stdout中 codec =&gt; rubydebug ，方便部署时验证是否正常运行，验证通过后，可以去掉。</p>
</div>

        </div>
        <div id="footer">
            <span>
                Copyright © 2012-2016 .
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
            </span>
        </div>
        
    </body>
</html>