<!DOCTYPE HTML>
<html>
    <head>
        <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
        <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
        <title>ELK - Wiki | janes</title>
        <meta name="keywords" content=""/>
        <meta name="description" content=""/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="container">
            
<div id="header">
  <div id="post-nav"><a href="/">Home</a>&nbsp;»&nbsp;<a href="/#Note">Note</a>&nbsp;»&nbsp;ELK</div>
</div>
<div class="clearfix"></div>
<div id="title">ELK</div>
  <div id="content">
  <h2 id="_1">简介</h2>
<p><a href="http://kibana.logstash.es/content/">ELK 中文指南</a></p>
<p>ELK 是 Elasticsearch、Logstash、Kibana 三个开源软件的组合</p>
<h3 id="elasticsearch">ElasticSearch</h3>
<p>Elasticsearch是一个基于Apache Lucene(TM)的开源的实时分布式搜索和分析引擎,可以快速处理大数据，用于全文搜索、结构化搜索、分析以及将这三者混合使用。</p>
<p><a href="https://www.elastic.co/downloads/elasticsearch">Elasticsearch download</a></p>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/_installation.html">Elasticsearch install and running</a></p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">cd</span> <span class="n">elasticsearch</span><span class="o">-</span><span class="mf">2.3.1</span>
<span class="err">$</span> <span class="n">bin</span><span class="o">/</span><span class="n">elasticsearch</span>

<span class="cp"># browser http:</span><span class="c1">//locaolhost:9200</span>

<span class="cp"># get the following output</span>
<span class="p">{</span>
  <span class="s">&quot;name&quot;</span> <span class="o">:</span> <span class="s">&quot;X-23&quot;</span><span class="p">,</span>
  <span class="s">&quot;cluster_name&quot;</span> <span class="o">:</span> <span class="s">&quot;elasticsearch&quot;</span><span class="p">,</span>
  <span class="s">&quot;version&quot;</span> <span class="o">:</span> <span class="p">{</span>
    <span class="s">&quot;number&quot;</span> <span class="o">:</span> <span class="s">&quot;2.3.1&quot;</span><span class="p">,</span>
    <span class="s">&quot;build_hash&quot;</span> <span class="o">:</span> <span class="s">&quot;bd980929010aef404e7cb0843e61d0665269fc39&quot;</span><span class="p">,</span>
    <span class="s">&quot;build_timestamp&quot;</span> <span class="o">:</span> <span class="s">&quot;2016-04-04T12:25:05Z&quot;</span><span class="p">,</span>
    <span class="s">&quot;build_snapshot&quot;</span> <span class="o">:</span> <span class="nb">false</span><span class="p">,</span>
    <span class="s">&quot;lucene_version&quot;</span> <span class="o">:</span> <span class="s">&quot;5.5.0&quot;</span>
  <span class="p">},</span>
  <span class="s">&quot;tagline&quot;</span> <span class="o">:</span> <span class="s">&quot;You Know, for Search&quot;</span>
<span class="p">}</span>
</pre></div>


<h3 id="logstash">Logstash</h3>
<p><a href="https://www.elastic.co/downloads/logstash">logstash download</a></p>
<p><a href="https://www.elastic.co/guide/en/logstash/current/index.html">logstash document</a></p>
<p>run:</p>
<div class="hlcode"><pre><span class="cp">../logstash-2.3.1$ bin/logstash -e &#39;input{stdin{}}output{stdout{codec=&gt;rubydebug}}&#39;</span>
Settings: Default pipeline workers: 4
Pipeline main started
hello world
{
       &quot;message&quot; =&gt; &quot;hello world&quot;,
      &quot;@version&quot; =&gt; &quot;1&quot;,
    &quot;@timestamp&quot; =&gt; &quot;2016-04-13T03:37:00.404Z&quot;,
          &quot;host&quot; =&gt; &quot;kali&quot;
}
</pre></div>


<p>终端输入 Hello World，回车，然后看看会返回结果, 如上所示</p>
<h3 id="kibana">Kibana</h3>
<p><a href="https://www.elastic.co/downloads/kibana">kibana download</a></p>
<p><a href="https://www.elastic.co/guide/en/kibana/current/setup.html">kibana install and running</a></p>
<p>download tar.gz and extract</p>
<div class="hlcode"><pre><span class="n">cd</span> <span class="n">kibana</span><span class="o">-</span><span class="mf">4.5.0</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">x64</span><span class="o">/</span><span class="n">bin</span>
<span class="p">.</span><span class="o">/</span><span class="n">kibana</span> 

<span class="cp"># browser</span>
<span class="nl">http:</span><span class="c1">//localhost:5601</span>
</pre></div>


<p>install and run app sense</p>
<div class="hlcode"><pre><span class="n">cd</span> <span class="n">kibana</span><span class="o">-</span><span class="mf">4.5.0</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">x64</span><span class="o">/</span><span class="n">bin</span>
<span class="p">.</span><span class="o">/</span><span class="n">kibana</span> <span class="n">plugin</span> <span class="o">--</span><span class="n">install</span> <span class="n">elastic</span><span class="o">/</span><span class="n">sense</span>
<span class="p">.</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">kibana</span>
</pre></div>


<p>Open Sense your web browser by going to http://localhost:5601/app/sense</p>
<h3 id="elk">ELK</h3>
<div class="hlcode"><pre><span class="cp">### Elasticsearch ###</span>
<span class="n">cd</span> <span class="n">elasticsearch</span><span class="o">-</span><span class="mf">2.3.1</span>
<span class="n">bin</span><span class="o">/</span><span class="n">elasticsearch</span>


<span class="cp">### logstash ###</span>
<span class="n">cd</span> <span class="n">logstash</span><span class="o">-</span><span class="mf">2.3.1</span>
<span class="n">mkdir</span> <span class="n">conf</span> 
<span class="n">mkdir</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">logs</span>
<span class="n">echo</span> <span class="s">&quot;hello&quot;</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">logs</span><span class="o">/</span><span class="n">test</span><span class="p">.</span><span class="n">log</span>
<span class="n">vim</span> <span class="n">conf</span><span class="o">/</span><span class="n">logstash</span><span class="o">-</span><span class="n">indexer</span><span class="p">.</span><span class="n">conf</span>

<span class="n">input</span><span class="p">{</span>                                                                          
    <span class="n">file</span> <span class="p">{</span>
        <span class="n">path</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s">&quot;/var/opt/logs/test.log&quot;</span><span class="p">]</span>
    <span class="p">}</span>                                                                    
<span class="p">}</span>                                                                               

<span class="n">output</span> <span class="p">{</span>                                                                        
    <span class="n">elasticsearch</span> <span class="p">{</span>                                                             
        <span class="n">hosts</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s">&quot;localhost:9200&quot;</span><span class="p">]</span>                                             
    <span class="p">}</span>                                                                           

    <span class="n">stdout</span> <span class="p">{</span>                                                                    
        <span class="n">codec</span> <span class="o">=&gt;</span> <span class="n">rubydebug</span>                                                      
    <span class="p">}</span>                                                                           
<span class="p">}</span> 

<span class="n">bin</span><span class="o">/</span><span class="n">logstash</span> <span class="o">-</span><span class="n">f</span> <span class="n">conf</span><span class="o">/</span><span class="n">logstash</span><span class="o">-</span><span class="n">indexer</span><span class="p">.</span><span class="n">conf</span>


<span class="cp">### Kibana ###</span>
<span class="n">cd</span> <span class="n">kibana</span><span class="o">-</span><span class="mf">4.5.0</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">x64</span><span class="o">/</span>
<span class="n">vim</span> <span class="n">config</span><span class="o">/</span><span class="n">kibana</span><span class="p">.</span><span class="n">yml</span>

<span class="cp">## 更改如下 ##</span>
<span class="cp"># The Elasticsearch instance to use for all your queries.                  </span>
  <span class="mi">15</span> <span class="n">elasticsearch</span><span class="p">.</span><span class="n">url</span><span class="o">:</span> <span class="s">&quot;http://localhost:9200&quot;</span>

<span class="n">bin</span><span class="o">/</span><span class="n">kibana</span>


<span class="cp">### browser ### </span>
<span class="nl">http:</span><span class="c1">//localhost:5601  </span>
</pre></div>


<div class="hlcode"><pre><span class="cp"># Elasticseatch 后台进程运行</span>
<span class="n">nohup</span> <span class="p">.</span><span class="o">/</span><span class="n">elasticsearch</span> <span class="o">&amp;</span> 
</pre></div>


<p>新建索引配置文件logstash-indexer.conf，input{file{...}}部分指定的是日志文件的位置（可以多个文件）。output部分则是表示将日志文件的内容保存到elasticsearch，这里hosts对应的是一个数组，可以设置多个elasticsearch主机，相当于一份日志文件的内容，可以保存到多个elasticsearch中。stdout中 codec =&gt; rubydebug ，方便部署时验证是否正常运行，验证通过后，可以去掉。</p>
</div>

        </div>
        <div id="footer">
            <span>
                Copyright © 2012-2016 .
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
            </span>
        </div>
        
    </body>
</html>