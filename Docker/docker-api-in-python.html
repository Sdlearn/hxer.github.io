<!DOCTYPE HTML>
<html>
    <head>
        <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
        <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
        <title>docker api in python - Wiki | janes</title>
        <meta name="keywords" content=""/>
        <meta name="description" content=""/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="container">
            
<div id="header">
  <div id="post-nav"><a href="/">Home</a>&nbsp;»&nbsp;<a href="/#Docker">Docker</a>&nbsp;»&nbsp;docker api in python</div>
</div>
<div class="clearfix"></div>
<div id="title">docker api in python</div>
  <div id="content">
  <h2 id="docker">docker 远程访问</h2>
<p><a href="https://docs.docker.com/engine/admin/configuring/">docker config</a></p>
<p>默认情况下，Docker守护进程会生成一个socket（/var/run/docker.sock）文件来进行本地进程通信，而不会监听任何端口，因此只能在本地使用docker客户端或者使用Docker API进行操作。</p>
<p>如果想在其他主机上操作Docker主机，就需要让Docker守护进程监听一个端口，这样才能实现远程通信。</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="k">default</span><span class="o">/</span><span class="n">docker</span>

<span class="n">DOCKER_OPTS</span><span class="o">=</span><span class="s">&quot;-H unix:///var/run/docker.sock -H tcp://0.0.0.0:2375&quot;</span>

<span class="err">$</span> <span class="n">sudo</span> <span class="n">service</span> <span class="n">docker</span> <span class="n">restart</span>
</pre></div>


<p>这样就可以本地和远程访问docker进程了。</p>
<h2 id="docker-py">docker-py</h2>
<p><a href="https://letong.gitbooks.io/docker/content/API/python_api.html">Python API 操作</a>
<a href="https://docker-py.readthedocs.org/en/latest/api/">docker-py api</a></p>
<h2 id="install">install</h2>
<div class="hlcode"><pre><span class="n">pip</span> <span class="n">install</span> <span class="n">docker</span><span class="o">-</span><span class="n">py</span>
</pre></div>


<h2 id="client-api">Client API</h2>
<p>实例化Client class,与Dokcer daemon通信</p>
<div class="hlcode"><pre><span class="n">from</span> <span class="n">docker</span> <span class="n">import</span> <span class="n">Client</span>
<span class="n">cli</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="err">&#39;</span><span class="n">unix</span><span class="o">:</span><span class="c1">//var/run/docker.sock&#39;)</span>
</pre></div>


<p>params:</p>
<ul>
<li>base_url(str)</li>
<li>version(str)</li>
</ul>
<p>参考 ##protocol + hostname + port ## 方式</p>
<div class="hlcode"><pre><span class="n">base_url</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">tcp</span><span class="o">:</span><span class="c1">//127.0.0.1:2375&#39;</span>
<span class="n">base_url</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">unix</span><span class="o">:</span><span class="c1">//var/run/docker.sock&#39; </span>
</pre></div>


<h2 id="create_container">create_container</h2>
<h2 id="start">start</h2>
<p>params:</p>
<ul>
<li>contaner(str): The container to start</li>
</ul>
<div class="hlcode"><pre><span class="cp"># &#39;ubuntu&#39; is a container&#39;s name</span>
<span class="n">c</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="err">&#39;</span><span class="n">ubuntu</span><span class="err">&#39;</span><span class="p">)</span> 
</pre></div>


<p>return:</p>
<p>None if success</p>
<h2 id="stop">stop</h2>
<p>params:</p>
<ul>
<li>container(str): The container to start</li>
<li>timeout(int): Timeout in seconds to wait for the container to shop before sending a SIGKILL</li>
</ul>
<div class="hlcode"><pre><span class="cp"># &#39;ubuntu&#39; is a container&#39;s name</span>
<span class="n">c</span><span class="p">.</span><span class="n">stop</span><span class="p">(</span><span class="err">&#39;</span><span class="n">ubuntu</span><span class="err">&#39;</span><span class="p">)</span> 
</pre></div>


<p>return:</p>
<p>None if success</p>
<h2 id="stop_1">stop</h2>
</div>

        </div>
        <div id="footer">
            <span>
                Copyright © 2012-2016 .
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
            </span>
        </div>
        
    </body>
</html>